<!DOCTYPE html>


  <html class="light page-post">


<head>
  <!-- ä»£ç å—çš„é«˜äº® -->
  <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/rainbow.min.css">
  <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <!-- <link<! rel="stylesheet" href="/path/to/styles/default.css"> -->
  <!-- <script src="/path/to/highlight.pack.js"></script> -->
  <!-- <script>hljs.initHighlightingOnLoad();</script> -->


  <meta charset="utf-8">
  
  <title>iOSå¤šçº¿ç¨‹ | æˆ‘çš„åšå®¢åœ°å€</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="åŸºç¡€çŸ¥è¯†," />
  

  <meta name="description" content="iOSå¼€å‘å¤šçº¿ç¨‹é¦–å…ˆæˆ‘ä»¬æ¥ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µå’Œä»–ä»¬ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«:  å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ è¿›ç¨‹å’Œçº¿ç¨‹ è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨, è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½.â€‹çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“, æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾(èµ„æºåˆ†é…)çš„åŸºæœ¬å•ä½, å®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½. çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æº, åªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æº(å¦‚ç¨‹åºè®¡æ•°å™¨,">
<meta name="keywords" content="åŸºç¡€çŸ¥è¯†">
<meta property="og:type" content="article">
<meta property="og:title" content="iOSå¤šçº¿ç¨‹">
<meta property="og:url" content="http://hchong.net/2017/11/21/iOSå¤šçº¿ç¨‹/index.html">
<meta property="og:site_name" content="æˆ‘çš„åšå®¢åœ°å€">
<meta property="og:description" content="iOSå¼€å‘å¤šçº¿ç¨‹é¦–å…ˆæˆ‘ä»¬æ¥ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µå’Œä»–ä»¬ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«:  å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ è¿›ç¨‹å’Œçº¿ç¨‹ è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨, è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½.â€‹çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“, æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾(èµ„æºåˆ†é…)çš„åŸºæœ¬å•ä½, å®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½. çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æº, åªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æº(å¦‚ç¨‹åºè®¡æ•°å™¨,">
<meta property="og:locale" content="zh-zh-Hans">
<meta property="og:image" content="http://img.souche.com/f2e/5d7717afde012bbfc557f26bc5eaffea.png">
<meta property="og:updated_time" content="2017-11-26T16:17:46.532Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOSå¤šçº¿ç¨‹">
<meta name="twitter:description" content="iOSå¼€å‘å¤šçº¿ç¨‹é¦–å…ˆæˆ‘ä»¬æ¥ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µå’Œä»–ä»¬ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«:  å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ è¿›ç¨‹å’Œçº¿ç¨‹ è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨, è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½.â€‹çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“, æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾(èµ„æºåˆ†é…)çš„åŸºæœ¬å•ä½, å®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½. çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æº, åªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æº(å¦‚ç¨‹åºè®¡æ•°å™¨,">
<meta name="twitter:image" content="http://img.souche.com/f2e/5d7717afde012bbfc557f26bc5eaffea.png">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link href="/css/styles.css?v=d671a41f" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">æˆ³æˆ‘</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">æˆ³æˆ‘</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            åšå®¢
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            åˆ†ç±»
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            æ ‡ç­¾
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/Wiki/"
            rel="noopener noreferrer"
            target="_self"
            >
            Wiki
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            å…³äº
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            æœç´¢
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#iOSå¼€å‘å¤šçº¿ç¨‹"><span class="toc-text">iOSå¼€å‘å¤šçº¿ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ"><span class="toc-text">å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ"><span class="toc-text">å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pthresds"><span class="toc-text">Pthresds</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSThread"><span class="toc-text">NSThread</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCD"><span class="toc-text">GCD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSOperation-amp-NSOperationQueue"><span class="toc-text">NSOperation & NSOperationQueue</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¸¸è§çš„ä½¿ç”¨æ–¹å¼"><span class="toc-text">å¸¸è§çš„ä½¿ç”¨æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><span class="toc-text">GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><span class="toc-text">GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡"><span class="toc-text">GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCD-å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><span class="toc-text">GCD å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDç›‘å¬å¹¶è¡Œé˜Ÿåˆ—ä¸­å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆ"><span class="toc-text">GCDç›‘å¬å¹¶è¡Œé˜Ÿåˆ—ä¸­å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDå»¶æ—¶æ“ä½œ"><span class="toc-text">GCDå»¶æ—¶æ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDå•ä¾‹"><span class="toc-text">GCDå•ä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSOperationçš„ä¼˜å…ˆçº§"><span class="toc-text">NSOperationçš„ä¼˜å…ˆçº§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSOperationçš„ä¾èµ–å…³ç³»"><span class="toc-text">NSOperationçš„ä¾èµ–å…³ç³»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ"><span class="toc-text">å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ</span></a></li></ol></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-iOSå¤šçº¿ç¨‹" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">iOSå¤šçº¿ç¨‹</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.11.21</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>HChong</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/åŸºç¡€çŸ¥è¯†/">åŸºç¡€çŸ¥è¯†</a>
  </span>



      
        <span>
          <i class="icon-comment"></i>
          <a href="http://www.hchong.net/2017/11/21/iOSå¤šçº¿ç¨‹/#disqus_thread"></a>
        </span>
      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbspçƒ­åº¦ <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>â„ƒ
        </span>
      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <h1 id="iOSå¼€å‘å¤šçº¿ç¨‹"><a href="#iOSå¼€å‘å¤šçº¿ç¨‹" class="headerlink" title="iOSå¼€å‘å¤šçº¿ç¨‹"></a>iOSå¼€å‘å¤šçº¿ç¨‹</h1><p>é¦–å…ˆæˆ‘ä»¬æ¥ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µå’Œä»–ä»¬ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«: </p>
<h2 id="å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ"><a href="#å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ" class="headerlink" title="å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ"></a>å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ</h2><ol>
<li><p>è¿›ç¨‹å’Œçº¿ç¨‹</p>
<p>è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨, è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½.<br>â€‹<br>çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“, æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾(èµ„æºåˆ†é…)çš„åŸºæœ¬å•ä½, å®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½. çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æº, åªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æº(å¦‚ç¨‹åºè®¡æ•°å™¨, ä¸€ç»„å¯„å­˜å™¨å’Œæ ˆ), ä½†æ˜¯å®ƒå¯ä¸åŒå±ä¸€ä¸ªè¿›ç¨‹çš„å…¶ä»–çš„çº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æº. </p>
<p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå’Œæ’¤é”€å¦ä¸€ä¸ªçº¿ç¨‹; åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œ. </p>
<p>è¿›ç¨‹å’Œçº¿ç¨‹çš„ä¸»è¦å·®åˆ«åœ¨äºå®ƒä»¬æ˜¯ä¸åŒçš„æ“ä½œç³»ç»Ÿèµ„æºç®¡ç†æ–¹å¼. è¿›ç¨‹æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´, ä¸€ä¸ªè¿›ç¨‹å´©æºƒå, åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹äº§ç”Ÿå½±å“. è€Œçº¿ç¨‹åªæ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒæ‰§è¡Œè·¯å¾„. çº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡, ä½†çº¿ç¨‹ä¹‹é—´æ²¡æœ‰å•ç‹¬çš„åœ°å€ç©ºé—´, ä¸€ä¸ªçº¿ç¨‹æ­»æ‰å°±ç­‰äºæ•´ä¸ªè¿›ç¨‹æ­»æ‰, æ‰€ä»¥å¤šè¿›ç¨‹çš„ç¨‹åºè¦æ¯”å¤šçº¿ç¨‹çš„ç¨‹åºå¥å£®, ä½†åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶, è€—è´¹èµ„æºè¾ƒå¤§, æ•ˆç‡è¦å·®ä¸€äº›. ä½†å¯¹äºä¸€äº›è¦æ±‚åŒæ—¶è¿›è¡Œå¹¶ä¸”åˆè¦å…±äº«æŸäº›å˜é‡çš„å¹¶å‘æ“ä½œ, åªèƒ½ç”¨çº¿ç¨‹, ä¸èƒ½ç”¨è¿›ç¨‹. </p>
<ol>
<li>ç®€è€Œè¨€ä¹‹, ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹, ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹.<ol>
<li>çº¿ç¨‹çš„åˆ’åˆ†å°ºåº¦å°äºè¿›ç¨‹, ä½¿å¾—å¤šçº¿ç¨‹ç¨‹åºçš„å¹¶å‘æ€§é«˜. </li>
<li>å¦å¤–, è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜å•å…ƒ, è€Œå¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜, ä»è€Œæå¤§åœ°æé«˜äº†ç¨‹åºçš„è¿è¡Œæ•ˆç‡. </li>
<li>çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸è¿›ç¨‹è¿˜æ˜¯æœ‰åŒºåˆ«çš„. æ¯ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æœ‰ä¸€ä¸ªç¨‹åºè¿è¡Œçš„å…¥å£, é¡ºåºæ‰§è¡Œåºåˆ—å’Œç¨‹åºçš„å‡ºå£. ä½†æ˜¯çº¿ç¨‹ä¸èƒ½å¤Ÿç‹¬ç«‹æ‰§è¡Œ, å¿…é¡»ä¾å­˜åœ¨åº”ç”¨ç¨‹åºä¸­, ç”±åº”ç”¨ç¨‹åºæä¾›å¤šä¸ªçº¿ç¨‹æ‰§è¡Œæ§åˆ¶. </li>
<li>ä»é€»è¾‘è§’åº¦æ¥çœ‹, å¤šçº¿ç¨‹çš„æ„ä¹‰åœ¨äºä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­, æœ‰å¤šä¸ªæ‰§è¡Œéƒ¨åˆ†å¯ä»¥åŒæ—¶æ‰§è¡Œ. ä½†æ“ä½œç³»ç»Ÿå¹¶æ²¡æœ‰å°†å¤šä¸ªçº¿ç¨‹çœ‹åšå¤šä¸ªç‹¬ç«‹çš„åº”ç”¨, æ¥å®ç°è¿›ç¨‹çš„è°ƒåº¦å’Œç®¡ç†ä»¥åŠèµ„æºåˆ†é…. è¿™å°±æ˜¯è¿›ç¨‹å’Œçº¿ç¨‹çš„é‡è¦åŒºåˆ«.</li>
</ol>
</li>
</ol>
<p>æ‰“ä¸ªæ¯”æ–¹, å¤šè¿›ç¨‹å°±å¥½æ¯”åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åº. æ¯”å¦‚åŒæ—¶è¿è¡ŒQQ, éŸ³ä¹æ’­æ”¾å™¨, ä»¥åŠæµè§ˆå™¨. å¤šçº¿ç¨‹å°±æ˜¯åŒä¸€æ—¶åˆ»æ‰§è¡Œå¤šä¸ªçº¿ç¨‹, ç”¨æµè§ˆå™¨ä¸€è¾¹ä¸‹è½½, ä¸€è¾¹å¬æ­Œ, ä¸€è¾¹çœ‹è§†é¢‘, ä¸€è¾¹çœ‹ç½‘é¡µ. æµè§ˆå™¨è¿™ä¸ªè¿›ç¨‹ä¸‹æœ‰å¤šä¸ªçº¿ç¨‹, è¿™äº›çº¿ç¨‹å…±äº«ç³»ç»Ÿåˆ†é…ç»™æµè§ˆå™¨è¿™ä¸ªè¿›ç¨‹çš„èµ„æº, æ‰€ä»¥å„ä¸ªçº¿ç¨‹ä¹‹é—´å¯å¾ˆæ–¹ä¾¿çš„é€šä¿¡, ä¸€ä¸ªçº¿ç¨‹æ­»äº†, ä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œ. å¦‚æœæµè§ˆå™¨è¿™ä¸ªè¿›ç¨‹æ­»äº†, é‚£ä¹ˆä»–ä¸‹é¢çš„æ‰€æœ‰çº¿ç¨‹å°±éƒ½ç”¨ä¸äº†äº†. æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨æ‰“å¼€QQè¿™é‡Œå°±æ˜¯è¿›ç¨‹é—´é€šä¿¡, ç”±äºä¸åŒçš„è¿›ç¨‹ç³»ç»Ÿèµ„æºä¸åŒ, æ‰€ä»¥è¿›ç¨‹é—´çš„é€šä¿¡ä¸æ˜¯å¾ˆå®¹æ˜“å®ç°. å¹¶ä¸”åˆ‡æ¢è¿›ç¨‹ä¼šæœ‰æ€§èƒ½é—®é¢˜.</p>
</li>
<li><p>å¹¶å‘å’Œå¹¶è¡Œ</p>
<p> å¹¶å‘æŒ‡èƒ½å¤Ÿè®©å¤šä¸ªä»»åŠ¡åœ¨é€»è¾‘ä¸Šäº¤ç»‡æ‰§è¡Œçš„ç¨‹åºè®¾è®¡, ä½†å¹¶å‘äº‹ä»¶ä¹‹é—´ä¸ä¸€å®šè¦åŒä¸€æ—¶åˆ»å‘ç”Ÿ. å¹¶è¡ŒæŒ‡çš„æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„çŠ¶æ€æ˜¯ç‰©ç†ä¸ŠåŒæ—¶æ‰§è¡Œ, æ˜¯æŒ‡åŒæ—¶å‘ç”Ÿçš„ä¸¤ä¸ªå¹¶å‘äº‹ä»¶, å…·æœ‰å¹¶å‘çš„å«ä¹‰, è€Œå¹¶å‘åˆ™ä¸ä¸€å®šå¹¶è¡Œ. </p>
<p> å¹¶å‘æ˜¯ä¸€ç§ç°è±¡, é¢å¯¹è¿™ä¸€ç°è±¡, æˆ‘ä»¬é¦–å…ˆåˆ›å»ºå¤šä¸ªçº¿ç¨‹. çœŸæ­£åŠ å¿«ç¨‹åºè¿è¡Œé€Ÿåº¦çš„, æ˜¯å¹¶è¡ŒæŠ€æœ¯. ä¹Ÿå°±æ˜¯è®©å¤šä¸ªCPUåŒæ—¶å·¥ä½œ. è€Œå¤šçº¿ç¨‹, æ˜¯ä¸ºäº†è®©å¤šä¸ªCPUåŒæ—¶å·¥ä½œæˆä¸ºå¯èƒ½. å¹¶å‘è®¾è®¡è®©å¹¶å‘æ‰§è¡Œæˆä¸ºå¯èƒ½, è€Œå¹¶è¡Œæ˜¯å¹¶å‘æ‰§è¡Œçš„ä¸€ç§æ¨¡å¼.</p>
<p> å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«å°±æ˜¯ä¸€ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´å’Œä¸‰ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´. ä¸€ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´ä½†æ˜¯åŒä¸€æ—¶é—´åªèƒ½å•ƒä¸€ä¸ªé¦’å¤´, ä¸‰ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´, ä¸‰ä¸ªé¦’å¤´åŒä¸€æ—¶é—´éƒ½ä¼šè¢«å•ƒ.</p>
<p> ä¸‹å›¾åæ˜ äº†ä¸€ä¸ªåŒ…å«8ä¸ªæ“ä½œçš„ä»»åŠ¡åœ¨ä¸€ä¸ªæœ‰ä¸¤æ ¸å¿ƒçš„CPUä¸­åˆ›å»ºå››ä¸ªçº¿ç¨‹è¿è¡Œçš„æƒ…å†µ. å‡è®¾æ¯ä¸ªæ ¸å¿ƒæœ‰ä¸¤ä¸ªçº¿ç¨‹, é‚£ä¹ˆæ¯ä¸ªCPUä¸­ä¸¤ä¸ªçº¿ç¨‹ä¼šäº¤æ›¿å¹¶å‘, ä¸¤ä¸ªCPUä¹‹é—´çš„æ“ä½œä¼šå¹¶è¡Œè¿ç®—. å°±CPU1è€Œè¨€è™½ç„¶å®ç°äº†å¹¶å‘ä½†æ˜¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨è¿›è¡Œ, CPUåªæ˜¯å¿«é€Ÿçš„åœ¨ä»»åŠ¡ä¹‹é—´åˆ‡æ¢, CPU1å’ŒCPU2æ•´ä½“æ¥çœ‹æ˜¯å¹¶è¡Œå…ƒç®—, åŒä¸€æ—¶é—´æ˜¯æœ‰å¤šä¸ªä»»åŠ¡åœ¨è¿›è¡Œ. å•å°±ä¸€ä¸ªCPUè€Œè¨€ä¸¤ä¸ªçº¿ç¨‹å¯ä»¥è§£å†³çº¿ç¨‹é˜»å¡é€ æˆçš„ä¸æµç•…é—®é¢˜, å…¶æœ¬èº«è¿è¡Œæ•ˆç‡å¹¶æ²¡æœ‰æé«˜. å¤šCPUçš„å¹¶è¡Œè¿ç®—æ‰çœŸæ­£è§£å†³äº†è¿è¡Œæ•ˆç‡é—®é¢˜, è¿™ä¹Ÿæ­£æ˜¯å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«. </p>
<p> <img src="http://img.souche.com/f2e/5d7717afde012bbfc557f26bc5eaffea.png" alt="å¹¶å‘å’Œå¹¶è¡Œ"></p>
<p> æ³¨æ„: å¹¶è¡Œå’Œä¸²è¡Œæ˜¯ç›¸å¯¹åº”çš„. ä¸²è¡Œåœ¨ç‰©ç†å±‚é¢ä¸ŠåŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨è¿›è¡Œ.</p>
</li>
<li><p>åŒæ­¥å’Œå¼‚æ­¥</p>
<p> åŒæ­¥åœ¨å‘å‡ºä¸€ä¸ªåŒæ­¥è°ƒç”¨æ—¶, åœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰, è¯¥è°ƒç”¨å°±ä¸è¿”å›. å¤šä¸ªä»»åŠ¡æƒ…å†µä¸‹, ä¸€ä¸ªä»»åŠ¡Aæ‰§è¡Œç»“æŸ, æ‰å¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªä»»åŠ¡B. åªå­˜åœ¨ä¸€ä¸ªçº¿ç¨‹. å¼‚æ­¥åœ¨å‘å‡ºä¸€ä¸ªå¼‚æ­¥è°ƒç”¨å, è°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœ, è¯¥è°ƒç”¨å°±è¿”å›äº†. å¤šä¸ªä»»åŠ¡æƒ…å†µä¸‹, ä¸€ä¸ªä»»åŠ¡Aæ­£åœ¨æ‰§è¡Œ, åŒæ—¶å¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªä»»åŠ¡B. ä»»åŠ¡Bä¸ç”¨ç­‰å¾…ä»»åŠ¡Aç»“æŸæ‰æ‰§è¡Œ. å­˜åœ¨å¤šæ¡çº¿ç¨‹. </p>
</li>
</ol>
<h2 id="å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ"><a href="#å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ" class="headerlink" title="å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ"></a>å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ</h2><p>åœ¨iOSå¼€å‘ä¸­å¸¸è§çš„å¤šçº¿ç¨‹æ–¹æ¡ˆä¸€å…±æœ‰4å¥—, åˆ†åˆ«æ˜¯<code>Pthreads</code>, <code>NSThread</code>, <code>GCD</code>, <code>NSOperation &amp; NSOperationQueue</code>. å‰ä¸¤ç§ä¸æ€ä¹ˆå¸¸ç”¨, è¿™é‡Œå°±ç®€å•çš„ä»‹ç»ä¸€ä¸‹, ç€é‡ä»‹ç»åä¸¤ç§. </p>
<h3 id="Pthresds"><a href="#Pthresds" class="headerlink" title="Pthresds"></a>Pthresds</h3><p>POSIXçº¿ç¨‹(POSIX threads), ç®€ç§°Pthreads, æ˜¯çº¿ç¨‹çš„POSIXæ ‡å‡†. è¯¥æ ‡å‡†å®šä¹‰äº†åˆ›å»ºå’Œæ“çºµçº¿ç¨‹çš„ä¸€æ•´å¥—API, åœ¨ç±»Unixæ“ä½œç³»ç»Ÿ(Unixã€Linuxã€Mac OSXç­‰)ä¸­, éƒ½ä½¿ç”¨Pthreadsä½œä¸ºæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹. é‚£ä¹Ÿå°±æ„å‘³ç€å¯ä»¥è·¨å¹³å°ä½¿ç”¨, ä½†æ˜¯ä½¿ç”¨èµ·æ¥ç‰¹åˆ«é…¸çˆ½. ğŸ™‚</p>
<pre><code>#import &lt;pthread.h&gt;

- (void)pthreadsDoTask {
    /*
     pthread_tï¼šçº¿ç¨‹æŒ‡é’ˆ
     pthread_attr_tï¼šçº¿ç¨‹å±æ€§
     pthread_mutex_tï¼šäº’æ–¥å¯¹è±¡
     pthread_mutexattr_tï¼šäº’æ–¥å±æ€§å¯¹è±¡
     pthread_cond_tï¼šæ¡ä»¶å˜é‡
     pthread_condattr_tï¼šæ¡ä»¶å±æ€§å¯¹è±¡
     pthread_key_tï¼šçº¿ç¨‹æ•°æ®é”®
     pthread_rwlock_tï¼šè¯»å†™é”
     //
     pthread_create()ï¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹
     pthread_exit()ï¼šç»ˆæ­¢å½“å‰çº¿ç¨‹
     pthread_cancel()ï¼šä¸­æ–­å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„è¿è¡Œ
     pthread_join()ï¼šé˜»å¡å½“å‰çš„çº¿ç¨‹, ç›´åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿è¡Œç»“æŸ
     pthread_attr_init()ï¼šåˆå§‹åŒ–çº¿ç¨‹çš„å±æ€§
     pthread_attr_setdetachstate()ï¼šè®¾ç½®è„±ç¦»çŠ¶æ€çš„å±æ€§ï¼ˆå†³å®šè¿™ä¸ªçº¿ç¨‹åœ¨ç»ˆæ­¢æ—¶æ˜¯å¦å¯ä»¥è¢«ç»“åˆï¼‰
     pthread_attr_getdetachstate()ï¼šè·å–è„±ç¦»çŠ¶æ€çš„å±æ€§
     pthread_attr_destroy()ï¼šåˆ é™¤çº¿ç¨‹çš„å±æ€§
     pthread_kill()ï¼šå‘çº¿ç¨‹å‘é€ä¸€ä¸ªä¿¡å·
     pthread_equal(): å¯¹ä¸¤ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ ‡è¯†å·è¿›è¡Œæ¯”è¾ƒ
     pthread_detach(): åˆ†ç¦»çº¿ç¨‹
     pthread_self(): æŸ¥è¯¢çº¿ç¨‹è‡ªèº«çº¿ç¨‹æ ‡è¯†å·
     //
     *åˆ›å»ºçº¿ç¨‹
     int pthread_create(pthread_t _Nullable * _Nonnull __restrict, //æŒ‡å‘æ–°å»ºçº¿ç¨‹æ ‡è¯†ç¬¦çš„æŒ‡é’ˆ
     const pthread_attr_t * _Nullable __restrict,  //è®¾ç½®çº¿ç¨‹å±æ€§. é»˜è®¤å€¼NULL. 
     void * _Nullable (* _Nonnull)(void * _Nullable),  //è¯¥çº¿ç¨‹è¿è¡Œå‡½æ•°çš„åœ°å€
     void * _Nullable __restrict);  //è¿è¡Œå‡½æ•°æ‰€éœ€çš„å‚æ•°
     *è¿”å›å€¼ï¼š
     *è‹¥çº¿ç¨‹åˆ›å»ºæˆåŠŸ, åˆ™è¿”å›0
     *è‹¥çº¿ç¨‹åˆ›å»ºå¤±è´¥, åˆ™è¿”å›å‡ºé”™ç¼–å·
     */

    //
    pthread_t thread = NULL;
    NSString *params = @&quot;Hello World&quot;;
    int result = pthread_create(&amp;thread, NULL, threadTask, (__bridge void *)(params));
    result == 0 ? NSLog(@&quot;creat thread success&quot;) : NSLog(@&quot;creat thread failure&quot;);
    //è®¾ç½®å­çº¿ç¨‹çš„çŠ¶æ€è®¾ç½®ä¸ºdetached,åˆ™è¯¥çº¿ç¨‹è¿è¡Œç»“æŸåä¼šè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰èµ„æº
    pthread_detach(thread);
}

void *threadTask(void *params) {
    NSLog(@&quot;%@ - %@&quot;, [NSThread currentThread], (__bridge NSString *)(params));
    return NULL;
}
</code></pre><p>çœ‹ä¸‹è¿™äº›APIè®¾è®¡å¯ä»¥è¯´æ˜¯ç›¸å½“ä¸å‹å¥½, å¹¶ä¸”éœ€è¦æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹çš„å„ä¸ªçŠ¶æ€çš„è½¬æ¢å’Œç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†.</p>
<h3 id="NSThread"><a href="#NSThread" class="headerlink" title="NSThread"></a>NSThread</h3><p><code>NSThread</code>çš„APIè®¾è®¡å¤§è‡´å¦‚ä¸‹: </p>
<pre><code>@interface NSThread : NSObject
//å½“å‰çº¿ç¨‹
@property (class, readonly, strong) NSThread *currentThread;
//ä½¿ç”¨ç±»æ–¹æ³•åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡
+ (void)detachNewThreadWithBlock:(void (^)(void))block API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));
+ (void)detachNewThreadSelector:(SEL)selector toTarget:(id)target withObject:(nullable id)argument;
//åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºå¤šçº¿ç¨‹
+ (BOOL)isMultiThreaded;
//æŒ‡å®šçº¿ç¨‹çš„çº¿ç¨‹å‚æ•°, ä¾‹å¦‚è®¾ç½®å½“å‰çº¿ç¨‹çš„æ–­è¨€å¤„ç†å™¨. 
@property (readonly, retain) NSMutableDictionary *threadDictionary;
//å½“å‰çº¿ç¨‹æš‚åœåˆ°æŸä¸ªæ—¶é—´
+ (void)sleepUntilDate:(NSDate *)date;
//å½“å‰çº¿ç¨‹æš‚åœä¸€æ®µæ—¶é—´
+ (void)sleepForTimeInterval:(NSTimeInterval)ti;
//é€€å‡ºå½“å‰çº¿ç¨‹
+ (void)exit;
//å½“å‰çº¿ç¨‹ä¼˜å…ˆçº§
+ (double)threadPriority;
//è®¾ç½®å½“å‰çº¿ç¨‹ä¼˜å…ˆçº§
+ (BOOL)setThreadPriority:(double)p;
//æŒ‡å®šçº¿ç¨‹å¯¹è±¡ä¼˜å…ˆçº§ 0.0ï½1.0, é»˜è®¤å€¼ä¸º0.5
@property double threadPriority NS_AVAILABLE(10_6, 4_0);
//æœåŠ¡è´¨é‡
@property NSQualityOfService qualityOfService NS_AVAILABLE(10_10, 8_0);
//çº¿ç¨‹åç§°
@property (nullable, copy) NSString *name NS_AVAILABLE(10_5, 2_0);
//æ ˆåŒºå¤§å°
@property NSUInteger stackSize NS_AVAILABLE(10_5, 2_0);
//æ˜¯å¦ä¸ºä¸»çº¿ç¨‹
@property (class, readonly) BOOL isMainThread NS_AVAILABLE(10_5, 2_0);
//è·å–ä¸»çº¿ç¨‹
@property (class, readonly, strong) NSThread *mainThread NS_AVAILABLE(10_5, 2_0);
//åˆå§‹åŒ–
- (instancetype)init NS_AVAILABLE(10_5, 2_0) NS_DESIGNATED_INITIALIZER;
//å®ä¾‹æ–¹æ³•åˆå§‹åŒ–, éœ€è¦å†è°ƒç”¨startæ–¹æ³•
- (instancetype)initWithTarget:(id)target selector:(SEL)selector object:(nullable id)argument NS_AVAILABLE(10_5, 2_0);
- (instancetype)initWithBlock:(void (^)(void))block API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));
//çº¿ç¨‹çŠ¶æ€, æ­£åœ¨æ‰§è¡Œ
@property (readonly, getter=isExecuting) BOOL executing NS_AVAILABLE(10_5, 2_0);
//çº¿ç¨‹çŠ¶æ€, æ­£åœ¨å®Œæˆ
@property (readonly, getter=isFinished) BOOL finished NS_AVAILABLE(10_5, 2_0);
//çº¿ç¨‹çŠ¶æ€, å·²ç»å–æ¶ˆ
@property (readonly, getter=isCancelled) BOOL cancelled NS_AVAILABLE(10_5, 2_0);
//å–æ¶ˆ, ä»…ä»…æ”¹å˜çº¿ç¨‹çŠ¶æ€, å¹¶ä¸èƒ½åƒexistä¸€æ ·çœŸæ­£çš„ç»ˆæ­¢çº¿ç¨‹
- (void)cancel NS_AVAILABLE(10_5, 2_0);
//å¼€å§‹
- (void)start NS_AVAILABLE(10_5, 2_0);
//çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„ä»£ç , ä¸€èˆ¬å†™å­ç±»çš„æ—¶å€™ä¼šç”¨åˆ°
- (void)main NS_AVAILABLE(10_5, 2_0);
@end

è¿˜æœ‰ä¸€ä¸ªNSObjectçš„åˆ†ç±»
@interface NSObject (NSThreadPerformAdditions)
//éšå¼çš„åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹, å¹¶åœ¨æŒ‡å®šçš„çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹æˆ–å­çº¿ç¨‹ï¼‰ä¸Šæ‰§è¡Œæ–¹æ³•. 
- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait modes:(nullable NSArray&lt;NSString *&gt; *)array;
- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait;
- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait modes:(nullable NSArray&lt;NSString *&gt; *)array NS_AVAILABLE(10_5, 2_0);
- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait NS_AVAILABLE(10_5, 2_0);
- (void)performSelectorInBackground:(SEL)aSelector withObject:(nullable id)arg NS_AVAILABLE(10_5, 2_0);
@end
</code></pre><p>å¸¸è§çš„ç”¨æ³•æœ‰ä»¥ä¸‹å‡ ç§: </p>
<pre><code>- (void) startThread {

    //åˆ›å»ºå¹¶ä¸”æ‰‹åŠ¨å¯åŠ¨
    NSThread *thread = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil];
    [thread start];

    //ç±»æ–¹æ³•åˆ›å»ºå¹¶ä¸”è‡ªåŠ¨å¯åŠ¨
    [NSThread detachNewThreadSelector:@selector(run) toTarget:self withObject:nil];

    //é€šè¿‡NSObjectçš„æ–¹æ³•è‡ªåŠ¨å¯åŠ¨
    [self performSelectorInBackground:@selector(run) withObject:nil];
}    

- (void)run {
    NSLog(@&quot;%@&quot;, [NSThread currentThread]);
}
</code></pre><h3 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h3><p>Grand Central Dispatch, å®ƒæ˜¯è‹¹æœä¸ºå¤šæ ¸çš„å¹¶è¡Œè¿ç®—æå‡ºçš„è§£å†³æ–¹æ¡ˆ, ä¼šè‡ªåŠ¨åˆç†åœ°åˆ©ç”¨æ›´å¤šçš„CPUå†…æ ¸(æ¯”å¦‚åŒæ ¸ã€å››æ ¸), æœ€é‡è¦çš„æ˜¯å®ƒä¼šè‡ªåŠ¨ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ(åˆ›å»ºçº¿ç¨‹ã€è°ƒåº¦ä»»åŠ¡ã€é”€æ¯çº¿ç¨‹), å®Œå…¨ä¸éœ€è¦æˆ‘ä»¬ç®¡ç†, æˆ‘ä»¬åªéœ€è¦å‘Šè¯‰å¹²ä»€ä¹ˆå°±è¡Œ. åŒæ—¶å®ƒä½¿ç”¨çš„ä¹Ÿæ˜¯Cè¯­è¨€, ä¸è¿‡ç”±äºä½¿ç”¨äº†Block(Swifté‡Œå«åšé—­åŒ…), ä½¿å¾—ä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿, è€Œä¸”çµæ´».</p>
<p>äº†è§£GCDæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸¤ä¸ªæ¦‚å¿µ, <strong><code>é˜Ÿåˆ—</code></strong>å’Œ<strong><code>ä»»åŠ¡</code></strong>.</p>
<ol>
<li><p>ä»»åŠ¡</p>
<p> è¦æ‰§è¡Œçš„æ“ä½œæˆ–æ–¹æ³•å‡½æ•°. åœ¨GCDä¸­æŒ‡çš„å°±æ˜¯blockå—, åœ¨NSThreadä¸­æŒ‡çš„æ˜¯<code>performSelector:</code>ä¸­çš„æ–¹æ³•. åŠ å…¥ä»»åŠ¡æ—¶æœ‰ä¸¤ç§å½¢å¼: <code>åŒæ­¥ä»»åŠ¡(dispatch_sync)</code>å’Œ<code>å¼‚æ­¥ä»»åŠ¡(dispatch_async)</code>.</p>
<ol>
<li>åŒæ­¥ä»»åŠ¡: ä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹, ä¼šé˜»å¡å½“å‰çº¿ç¨‹. å®Œæˆéœ€è¦åšçš„ä»»åŠ¡åæ‰ä¼šè¿”å›, è¿›è¡Œä¸‹ä¸€ä»»åŠ¡. åˆ›å»ºæ–¹å¼ä¸º:<pre><code>  //æŠŠå³è¾¹çš„å‚æ•°(ä»»åŠ¡)æäº¤ç»™å·¦è¾¹çš„å‚æ•°(é˜Ÿåˆ—)è¿›è¡Œæ‰§è¡Œ
  dispatch_sync(dispatch_queue_t queue, dispatch_block_t block);
</code></pre></li>
<li><p>å¼‚æ­¥ä»»åŠ¡: ä¸ä¼šç­‰å¾…ä»»åŠ¡å®Œæˆæ‰è¿”å›, ä¼šç«‹å³è¿”å›. å¼‚æ­¥æ˜¯å¤šçº¿ç¨‹çš„ä»£åè¯, å› ä¸ºå¿…å®šä¼šå¼€å¯æ–°çš„çº¿ç¨‹, çº¿ç¨‹çš„ç”³è¯·æ˜¯ç”±å¼‚æ­¥è´Ÿè´£, èµ·åˆ°å¼€åˆ†æ”¯çš„ä½œç”¨. åˆ›å»ºæ–¹å¼ä¸º:</p>
<pre><code>  //æŠŠå³è¾¹çš„å‚æ•°(ä»»åŠ¡)æäº¤ç»™å·¦è¾¹çš„å‚æ•°(é˜Ÿåˆ—)è¿›è¡Œæ‰§è¡Œ
  dispatch_async(dispatch_queue_t queue, dispatch_block_t block);
</code></pre></li>
</ol>
</li>
<li><p>é˜Ÿåˆ—</p>
<p> å­˜æ”¾ä»»åŠ¡çš„é›†åˆ, æˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ç„¶åæ‰§è¡Œ, GCDä¼šè‡ªåŠ¨å°†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æŒ‰å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼å–å‡º. é˜Ÿåˆ—ä¸»è¦æœ‰çš„æœ‰<code>ä¸²è¡Œé˜Ÿåˆ—(Serial Dispatch Queue)</code>, <code>å¹¶è¡Œé˜Ÿåˆ—(Concurrent Dispatch Queue)</code>, <code>å…¨å±€é˜Ÿåˆ—(Global Queue)</code>å’Œ<code>ä¸»é˜Ÿåˆ—(Main Queue)</code>.</p>
<ol>
<li><p>ä¸²è¡Œé˜Ÿåˆ—: ä»»åŠ¡ä¾æ¬¡æ‰§è¡Œ, åŒä¸€æ—¶é—´é˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œ, æ¯ä¸ªä»»åŠ¡åªæœ‰åœ¨å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆåæ‰èƒ½å¼€å§‹æ‰§è¡Œ. ä½ ä¸çŸ¥é“åœ¨ä¸€ä¸ªBlock(ä»»åŠ¡)æ‰§è¡Œç»“æŸåˆ°ä¸‹ä¸€ä¸ªBlock(ä»»åŠ¡)å¼€å§‹æ‰§è¡Œä¹‹é—´çš„è¿™æ®µæ—¶é—´æ—¶é—´æ˜¯å¤šé•¿, è¿™éƒ¨åˆ†æ˜¯ç”±GCDæ§åˆ¶. åˆ›å»ºæ–¹å¼ä¸º:</p>
<pre><code>  //åˆ›å»ºä¸€ä¸ªåä¸ºqueueçš„ä¸²è¡Œé˜Ÿåˆ—
  //ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—åç§°
  //ç¬¬äºŒä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—ç±»å‹, DISPATCH_QUEUE_SERIALå’ŒNULLè¡¨ç¤ºä¸²è¡Œé˜Ÿåˆ—
  dispatch_queue_t queue = dispatch_queue_create(&quot;com.private.SerialQueue&quot;, DISPATCH_QUEUE_SERIAL);
</code></pre></li>
<li><p>å¹¶è¡Œé˜Ÿåˆ—: ä»»åŠ¡å¹¶å‘æ‰§è¡Œ, å”¯ä¸€èƒ½ä¿è¯çš„æ˜¯, è¿™äº›ä»»åŠ¡ä¼šæŒ‰ç…§è¢«æ·»åŠ çš„é¡ºåºå¼€å§‹æ‰§è¡Œ. ä½†æ˜¯ä»»åŠ¡å¯ä»¥ä»¥ä»»ä½•é¡ºåºå®Œæˆ, ä½ ä¸çŸ¥é“åœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹, æˆ–è€…è¯´ä»»æ„æ—¶åˆ»æœ‰å¤šä¸ªBlock(ä»»åŠ¡)è¿è¡Œ, è¿™ä¸ªå®Œå…¨æ˜¯å–å†³äºGCD. GCDé»˜è®¤å·²ç»æä¾›äº†å…¨å±€çš„å¹¶å‘é˜Ÿåˆ—, ä¾›æ•´ä¸ªåº”ç”¨ä½¿ç”¨, ä¸€èˆ¬ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºåˆ›å»ºæ–¹å¼ä¸º:</p>
<pre><code>  //åˆ›å»ºä¸€ä¸ªåä¸ºqueueçš„å¹¶è¡Œé˜Ÿåˆ—
  //ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—åç§°
  //ç¬¬äºŒä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—ç±»å‹, DISPATCH_QUEUE_CONCURRENTè¡¨ç¤ºå¹¶è¡Œé˜Ÿåˆ—
  dispatch_queue_t queue = dispatch_queue_create(&quot;com.private.ConcurrentQueue&quot;,DISPATCH_QUEUE_CONCURRENT);
</code></pre></li>
<li><p>å…¨å±€é˜Ÿåˆ—: <strong>éš¶å±äºå¹¶è¡Œé˜Ÿåˆ—</strong>, ä¸è¦ä¸ barrier æ …æ æ–¹æ³•æ­é…ä½¿ç”¨, barrier åªæœ‰ä¸è‡ªå®šä¹‰çš„å¹¶è¡Œé˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨, æ‰èƒ½è®© barrier è¾¾åˆ°æˆ‘ä»¬æ‰€æœŸæœ›çš„æ …æ åŠŸèƒ½. ä¸ä¸²è¡Œé˜Ÿåˆ—æˆ–è€…globalé˜Ÿåˆ— ä¸€èµ·ä½¿ç”¨, barrierçš„è¡¨ç°ä¼šå’Œdispatch_syncæ–¹æ³•ä¸€æ ·. åˆ›å»ºæ–¹å¼ä¸º:</p>
<pre><code>  //è·å–ç³»ç»Ÿå…¨å±€é˜Ÿåˆ—, å¹¶èµ‹å€¼ç»™é˜Ÿåˆ—queue
  //ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºä¼˜å…ˆçº§, è¿™é‡Œæ˜¯æ–°è€ä¼˜å…ˆçº§çš„å¯¹ç…§Map
*  - DISPATCH_QUEUE_PRIORITY_HIGH:         QOS_CLASS_USER_INITIATED//é«˜
*  - DISPATCH_QUEUE_PRIORITY_DEFAULT:      QOS_CLASS_DEFAULT//é»˜è®¤
*  - DISPATCH_QUEUE_PRIORITY_LOW:          QOS_CLASS_UTILITY//ä½
*  - DISPATCH_QUEUE_PRIORITY_BACKGROUND:   QOS_CLASS_BACKGROUND//åå°

//ç¬¬äºŒä¸ªå‚æ•°æ˜¯é¢„ç•™å‚æ•°, ä¼ 0å°±å¥½
dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
</code></pre></li>
<li><p>ä¸»é˜Ÿåˆ—: <strong>éš¶å±äºä¸²è¡Œé˜Ÿåˆ—</strong>, ä¸èƒ½ä¸syncåŒæ­¥æ–¹æ³•æ­é…ä½¿ç”¨, ä¼šé€ æˆæ­»å¾ªç¯. ä¸»é˜Ÿåˆ—æ˜¯GCDè‡ªå¸¦çš„ä¸€ç§ç‰¹æ®Šçš„ä¸²è¡Œé˜Ÿåˆ—, æ”¾åœ¨ä¸»é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡, éƒ½ä¼šæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ. åˆ›å»ºæ–¹å¼ä¸º:</p>
<pre><code>  //è·å–ç³»ç»Ÿä¸»é˜Ÿåˆ—, å¹¶èµ‹å€¼ç»™é˜Ÿåˆ—queue
  dispatch_queue_t queue = dispatch_get_main_queue();
</code></pre></li>
</ol>
</li>
</ol>
<p>ä¸ç®¡æ˜¯ä¸²è¡Œé˜Ÿåˆ—(SerialQueue)è¿˜æ˜¯å¹¶è¡Œé˜Ÿåˆ—(ConcurrencyQueue), éƒ½æ˜¯FIFOé˜Ÿåˆ—. ä¹Ÿå°±æ„å‘³ç€, ä»»åŠ¡ä¸€å®šæ˜¯ä¸€ä¸ªä¸€ä¸ªåœ°, æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ¥æ‰§è¡Œ.</p>
<h3 id="NSOperation-amp-NSOperationQueue"><a href="#NSOperation-amp-NSOperationQueue" class="headerlink" title="NSOperation &amp; NSOperationQueue"></a>NSOperation &amp; NSOperationQueue</h3><p><code>NSOperation</code> æ˜¯è‹¹æœå…¬å¸å¯¹<code>GCD</code>çš„å°è£…, å®Œå…¨é¢å‘å¯¹è±¡, æ‰€ä»¥ä½¿ç”¨èµ·æ¥æ›´å¥½ç†è§£. å¤§å®¶å¯ä»¥çœ‹åˆ° <code>NSOperation</code>å’Œ<code>NSOperationQueue</code>åˆ†åˆ«å¯¹åº”<code>GCD</code>çš„<strong>ä»»åŠ¡</strong>å’Œ<strong>é˜Ÿåˆ—</strong>. æ‰€ä»¥ä»–çš„æ“ä½œæ­¥éª¤å’Œ<code>GCD</code>ç±»ä¼¼: é¦–å…ˆå°†è¦æ‰§è¡Œçš„ä»»åŠ¡å°è£…åˆ°ä¸€ä¸ª<code>NSOperation</code>å¯¹è±¡ä¸­. ç„¶åå°†æ­¤ä»»åŠ¡æ·»åŠ åˆ°ä¸€ä¸ª<code>NSOperationQueue</code>å¯¹è±¡ä¸­, ç„¶åç³»ç»Ÿå°±ä¼šè‡ªåŠ¨åœ¨æ‰§è¡Œä»»åŠ¡.</p>
<ol>
<li><p><code>NSOperation</code>ä¸»è¦æœ‰ä¸€ä¸‹è¿™äº›å±æ€§å’Œæ–¹æ³•. </p>
<pre><code>  â€‹```
 @interface NSOperation : NSObject {
 @private
     id _private;
     int32_t _private1;
 #if __LP64__
     int32_t _private1b;
 #endif
 }

 - (void)start;//å¯åŠ¨ä»»åŠ¡ é»˜è®¤åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ
 - (void)main;//è‡ªå®šä¹‰NSOperationï¼Œå†™ä¸€ä¸ªå­ç±»ï¼Œé‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢æ·»åŠ éœ€è¦æ‰§è¡Œçš„æ“ä½œã€‚

 @property (readonly, getter=isCancelled) BOOL cancelled;//æ˜¯å¦å·²ç»å–æ¶ˆï¼Œåªè¯»
 - (void)cancel;//å–æ¶ˆä»»åŠ¡

 @property (readonly, getter=isExecuting) BOOL executing;//æ­£åœ¨æ‰§è¡Œï¼Œåªè¯»
 @property (readonly, getter=isFinished) BOOL finished;//æ‰§è¡Œç»“æŸï¼Œåªè¯»
 @property (readonly, getter=isConcurrent) BOOL concurrent; // To be deprecated; use and override &#39;asynchronous&#39; below
 @property (readonly, getter=isAsynchronous) BOOL asynchronous NS_AVAILABLE(10_8, 7_0);//æ˜¯å¦å¹¶å‘ï¼Œåªè¯»
 @property (readonly, getter=isReady) BOOL ready;//å‡†å¤‡æ‰§è¡Œ

 - (void)addDependency:(NSOperation *)op;//æ·»åŠ ä¾èµ–
 - (void)removeDependency:(NSOperation *)op;//ç§»é™¤ä¾èµ–

 @property (readonly, copy) NSArray&lt;NSOperation *&gt; *dependencies;//æ‰€æœ‰ä¾èµ–å…³ç³»ï¼Œåªè¯»

 typedef NS_ENUM(NSInteger, NSOperationQueuePriority) {
     NSOperationQueuePriorityVeryLow = -8L,
     NSOperationQueuePriorityLow = -4L,
     NSOperationQueuePriorityNormal = 0,
     NSOperationQueuePriorityHigh = 4,
     NSOperationQueuePriorityVeryHigh = 8
 };//ç³»ç»Ÿæä¾›çš„ä¼˜å…ˆçº§å…³ç³»æšä¸¾

 @property NSOperationQueuePriority queuePriority;//æ‰§è¡Œä¼˜å…ˆçº§

 @property (nullable, copy) void (^completionBlock)(void) NS_AVAILABLE(10_6, 4_0);//ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åçš„å›è°ƒ

 - (void)waitUntilFinished NS_AVAILABLE(10_6, 4_0);//é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰åˆ°æŸä¸ªoperationæ‰§è¡Œå®Œæ¯•ã€‚

 @property double threadPriority NS_DEPRECATED(10_6, 10_10, 4_0, 8_0);//å·²åºŸå¼ƒï¼Œç”¨qualityOfServiceæ›¿ä»£ã€‚

 @property NSQualityOfService qualityOfService NS_AVAILABLE(10_10, 8_0);//æœåŠ¡è´¨é‡ï¼Œä¸€ä¸ªé«˜è´¨é‡çš„æœåŠ¡å°±æ„å‘³ç€æ›´å¤šçš„èµ„æºå¾—ä»¥æä¾›æ¥æ›´å¿«çš„å®Œæˆæ“ä½œã€‚

 @property (nullable, copy) NSString *name NS_AVAILABLE(10_10, 8_0);//ä»»åŠ¡åç§°

 @end
 â€‹```
</code></pre><p> ç”±äº<code>NSOperation</code>æ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±», ä¸èƒ½ç›´æ¥ä½¿ç”¨, åœ¨è¿™é‡Œæˆ‘ä¹ˆä½ ä¸€èˆ¬ä½¿ç”¨<code>NSOperation</code>çš„ä¸¤ä¸ªå­ç±»<code>NSInvocationOperation</code>å’Œ<code>NSBlockOperation</code>, æˆ–è€…<code>NSOperationçš„è‡ªå®šä¹‰å­ç±»</code>:</p>
<pre><code> 1. `NSInvocationOperation`åŸºäºåº”ç”¨çš„ä¸€ä¸ªtargetå¯¹è±¡å’Œselectoræ¥åˆ›å»ºoperation object. å¦‚æœä½ å·²ç»æœ‰ç°æœ‰çš„æ–¹æ³•æ¥æ‰§è¡Œéœ€è¦çš„ä»»åŠ¡, å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç±». ä½¿ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹: 

 ```
 - (void)NSInvocationOperationRun {
     NSInvocationOperation *invocationOper = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(invocationOperSel) object:nil];
     [invocationOper start];
 }
 - (void)invocationOperSel {
     NSLog(@&quot;NSInvocationOperationRun_%@&quot;, [NSThread currentThread]);
 }
 ```
</code></pre><p> ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡º, è¯¥å®ç°æ–¹å¼æ˜¯åŒæ­¥é¡ºåºæ‰§è¡Œ.</p>
<pre><code> 2.  `NSBlockOperation`ç”¨æ¥å¹¶å‘åœ°æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªblockå¯¹è±¡. operation objectä½¿ç”¨**ç»„**çš„è¯­ä¹‰æ¥æ‰§è¡Œå¤šä¸ªblockå¯¹è±¡ï¼Œæ‰€æœ‰ç›¸å…³çš„ block éƒ½æ‰§è¡Œå®Œæˆä¹‹å, operation objectæ‰ç®—å®Œæˆ. ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹

      ```
      //ç³»ç»Ÿæä¾›çš„API
      @interface NSBlockOperation : NSOperation {
      @private
          id _private2;
          void *_reserved2;
      }

     + (instancetype)blockOperationWithBlock:(void (^)(void))block;//åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ

     - (void)addExecutionBlock:(void (^)(void))block;//æ–°å¼€çº¿ç¨‹æ‰§è¡Œ
     @property (readonly, copy) NSArray&lt;void (^)(void)&gt; *executionBlocks;

     @end
      ```

 ä½¿ç”¨`NSBlockOperation`ç±»æ–¹æ³•åˆ›å»ºä»»åŠ¡, ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºæ¥è¯¥ä»»åŠ¡æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„

     ```
     - (void)NSBlockOperationRun {
         NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^{
             NSLog(@&quot;NSBlockOperationRun_%@_%@&quot;, [NSOperationQueue currentQueue], [NSThread currentThread]);
         }];
         [blockOper start];
     }
     ```

 ä½¿ç”¨`NBlockOperation`çš„å®ä¾‹æ–¹æ³•åˆ›å»ºä»»åŠ¡, ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºæ¥, ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ, å…¶ä»–ä»»åŠ¡å‡æ˜¯æ–°å¼€çš„çº¿ç¨‹, æ‰€æœ‰çš„ä»»åŠ¡æ˜¯ä»¥å¼‚æ­¥å¹¶å‘çš„å½¢å¼æ‰§è¡Œ. 

     ```
     - (void)NSBlockOperationRun {
         NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^{
             NSLog(@&quot;NSBlockOperationRun_1_%@&quot;, [NSThread currentThread]);
         }];
         [blockOper addExecutionBlock:^{
             NSLog(@&quot;NSBlockOperationRun_2_%@&quot;, [NSThread currentThread]);
         }];
         [blockOper addExecutionBlock:^{
             NSLog(@&quot;NSBlockOperationRun_3_%@&quot;, [NSThread currentThread]);
         }];
         [blockOper addExecutionBlock:^{
             NSLog(@&quot;NSBlockOperationRun_4_%@&quot;, [NSThread currentThread]);
         }];
         [blockOper start];
     }
     ```

 3. `NSOperationçš„è‡ªå®šä¹‰å­ç±»`. 

     ```        
     åœ¨å­ç±»ä¸­é‡å†™çˆ¶ç±»çš„`-(void)main`å‡½æ•°, åœ¨é‡Œé¢å®ç°ä¸»è¦é€»è¾‘
     ```
</code></pre><p>  <code>NSBlockOperation</code>, <code>NSBlockOperationRun</code>æˆ–è€…<code>NSOperationçš„è‡ªå®šä¹‰å­ç±»</code>åˆ›å»ºçš„operation objectéƒ½å¯ä»¥ä½¿ç”¨<code>NSOperation</code>çš„æ‰€æœ‰å±æ€§, æ„å‘³ç€ä»–ä»¬å…·æœ‰ä»¥ä¸‹ä¸»è¦ç‰¹æ€§: </p>
<ol>
<li>å¤šä¸ªä»»åŠ¡ä¹‹é—´å¯ä»¥ä½¿ç”¨æœ‰ä¾èµ–å…³ç³»</li>
<li>å¯ä»¥è·å¾—Operation objectä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åçš„å›è°ƒ</li>
<li>æ”¯æŒåº”ç”¨ä½¿ç”¨ KVO é€šçŸ¥æ¥ç›‘æ§ operation çš„æ‰§è¡ŒçŠ¶æ€</li>
<li>å¯ä»¥é€šè¿‡operationä¼˜å…ˆçº§, ä»è€Œå½±å“ç›¸å¯¹çš„æ‰§è¡Œé¡ºåº</li>
<li>å¯ä»¥ç»ˆæ­¢æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡</li>
</ol>
</li>
<li><p><code>NSOperationQueue</code></p>
<p> ç±»ä¼¼äºGCDä¸­çš„é˜Ÿåˆ—, åªéœ€è¦å§ä»»åŠ¡åŠ å…¥åˆ°<code>NSOperationQueue</code>ä¸­, å°±ä¼šè‡ªåŠ¨è¿è¡Œ, ç”±ç³»ç»Ÿé€šè¿‡æœ€å¤§å¹¶å‘æ•°æ¥æ§åˆ¶æ˜¯å¹¶è¡Œè¿˜æ˜¯ä¸²è¡Œ, å®˜æ–¹æä¾›çš„APIå¦‚ä¸‹:</p>
<pre><code> static const NSInteger NSOperationQueueDefaultMaxConcurrentOperationCount = -1;

 NS_CLASS_AVAILABLE(10_5, 2_0)
 @interface NSOperationQueue : NSObject {
 @private
     id _private;
     void *_reserved;
 }

 - (void)addOperation:(NSOperation *)op;//å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡
 - (void)addOperations:(NSArray&lt;NSOperation *&gt; *)ops waitUntilFinished:(BOOL)wait API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//æ·»åŠ ä¸€ç»„ä»»åŠ¡

 - (void)addOperationWithBlock:(void (^)(void))block API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//æ·»åŠ ä¸€ä¸ªblockå½¢å¼çš„ä»»åŠ¡

 @property (readonly, copy) NSArray&lt;__kindof NSOperation *&gt; *operations;//é˜Ÿåˆ—ä¸­æ‰€æœ‰ä»»åŠ¡çš„æ•°ç»„
 @property (readonly) NSUInteger operationCount API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//é˜Ÿåˆ—ä¸­æ‰€æœ‰ä»»åŠ¡æ•°

 @property NSInteger maxConcurrentOperationCount;//æœ€å¤§å¹¶å‘æ•°

 @property (getter=isSuspended) BOOL suspended;//æš‚åœ

 @property (nullable, copy) NSString *name API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//åç§°

 @property NSQualityOfService qualityOfService API_AVAILABLE(macos(10.10), ios(8.0), watchos(2.0), tvos(9.0));//æœåŠ¡è´¨é‡, ç³»ç»Ÿä¼šä¸ºæƒé‡é«˜çš„æœåŠ¡åˆ†é…æ›´å¤šçš„èµ„æº

 @property (nullable, assign /* actually retain */) dispatch_queue_t underlyingQueue API_AVAILABLE(macos(10.10), ios(8.0), watchos(2.0), tvos(9.0));

 - (void)cancelAllOperations;//å–æ¶ˆé˜Ÿåˆ—ä¸­æ‰€æœ‰çš„ä»»åŠ¡

 - (void)waitUntilAllOperationsAreFinished;//é˜»å¡å½“å‰çº¿ç¨‹, ç­‰åˆ°é˜Ÿåˆ—ä¸­çš„å…¨éƒ¨ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•

 @property (class, readonly, strong, nullable) NSOperationQueue *currentQueue API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//è·å–å½“å‰é˜Ÿåˆ—
 @property (class, readonly, strong) NSOperationQueue *mainQueue API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//è·å–ä¸»é˜Ÿåˆ—

 @end
</code></pre><p> ä½¿ç”¨æ–¹å¼å¦‚ä¸‹:</p>
<pre><code> //ä»¥ä¸‰ç§æ–¹å¼ä¸ºé˜Ÿåˆ—æ·»åŠ äº†ä¸‰ä¸ªä»»åŠ¡, 
 - (void)NSOperationQueueRun {
     NSOperationQueue *queue = [[NSOperationQueue alloc] init];
     NSInvocationOperation *invocationOper = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(invocationOperSel) object:nil];
     [queue addOperation:invocationOper];
     NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^{
         NSLog(@&quot;NSBlockOperationRun_%@&quot;, [NSThread currentThread]);
     }];
     [queue addOperation:blockOper];
     [queue addOperationWithBlock:^{
         NSLog(@&quot;QUEUEBlockOperationRun_%@&quot;, [NSThread currentThread]);
     }];
 }

 - (void)invocationOperSel {
     NSLog(@&quot;NSInvocationOperationRun_%@&quot;, [NSThread currentThread]);
 }
</code></pre><p> ä¸€èˆ¬æƒ…å†µä¸‹, <code>NSOperationQueue</code>ä¼šæŒ‰ç…§ä»»åŠ¡æ·»åŠ çš„é¡ºåºæ¥æ‰§è¡Œä»»åŠ¡, ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ä¼˜å…ˆçº§å’Œä¾èµ–å…³ç³»æ¥æ”¹å˜æ‰§è¡Œé¡ºåº. å¹¶å‘æ•°å¤§äºä»»åŠ¡æ•°, æ²¡æœ‰è®¾ç½®ä¾èµ–å…³ç³», å¹¶ä¸”åœ¨åŒä¸€é˜Ÿåˆ—.</p>
</li>
</ol>
<h2 id="å¸¸è§çš„ä½¿ç”¨æ–¹å¼"><a href="#å¸¸è§çš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="å¸¸è§çš„ä½¿ç”¨æ–¹å¼"></a>å¸¸è§çš„ä½¿ç”¨æ–¹å¼</h2><h3 id="GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><a href="#GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"></a>GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</h3><p>è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥è·å–ç³»ç»Ÿæä¾›çš„å…¨å±€å¹¶è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡. ä»»åŠ¡ä¼šéµå®ˆFIFOåŸåˆ™æ¥æ‰§è¡Œ, ä½†æ˜¯æ¯ä¸ªä»»åŠ¡ä½•æ—¶æ‰§è¡Œå®Œæˆ‘ä»¬å´å¹¶ä¸çŸ¥é“. ä½†æ˜¯ç³»ç»Ÿä¼šæ–°å¼€çº¿ç¨‹æ¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡, ä¸‰ä¸ªå¼‚æ­¥ä»»åŠ¡ä¼šåˆ†åˆ«åœ¨ä¸‰ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ, å„ä¸ªä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæ— æ³•ç¡®å®š.</p>
<pre><code>- (void)test1 {
    //è·å–ç³»ç»Ÿæä¾›çš„å…¨å±€é˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_async(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]);
        sleep(5);
    });

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_async(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]);
    });

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_async(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]);
    });
}
</code></pre><h3 id="GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><a href="#GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"></a>GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</h3><p>è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡. ä»»åŠ¡ä¼šéµå®ˆFIFOåŸåˆ™æ¥æ‰§è¡Œ, æ¯ä¸ªä»»åŠ¡ä½•æ—¶æ‰§è¡Œå®Œæˆ‘ä»¬å´å¹¶ä¸çŸ¥é“. ä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯åœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ çš„ä»»åŠ¡, ä¸ä¼šæ–°å¼€çº¿ç¨‹, æ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡ä¼šæŒ‰ç…§é¡ºåºå‰ä¸€ä¸ªæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œåä¸€ä¸ª.</p>
<pre><code> - (void)test2 {
    //åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—, ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸²è¡Œé˜Ÿåˆ—çš„åç§°, ç¬¬äºŒä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—çš„å±æ€§, NULLæˆ–è€…DISPATCH_QUEUE_SERIALè¡¨ç¤ºæ˜¯ä¸²è¡Œé˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_queue_create(&quot;test2&quot;, NULL);

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_async(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]);
        sleep(5);
    });

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_async(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]);
    });

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_async(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]);
    });
}
</code></pre><h3 id="GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡"><a href="#GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡" class="headerlink" title="GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡"></a>GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡</h3><p>è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥è·å–ç³»ç»Ÿæä¾›çš„å…¨å±€å¹¶è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ åŒæ­¥ä»»åŠ¡. ä»»åŠ¡ä¼šéµå®ˆFIFOåŸåˆ™æ¥æ‰§è¡Œ, æ¯ä¸ªä»»åŠ¡ä½•æ—¶æ‰§è¡Œå®Œæˆ‘ä»¬å´å¹¶ä¸çŸ¥é“. è™½ç„¶æ˜¯å¹¶è¡Œé˜Ÿåˆ—, å•ç”±äºæ·»åŠ çš„æ˜¯åŒæ­¥ä»»åŠ¡, ä¸ä¼šæ–°å¼€çº¿ç¨‹, å…¨éƒ½åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œ, æ‰€ä»¥ä¸‰ä¸ªä»»åŠ¡ä¼šé¡ºåºæ‰§è¡Œ, å¹¶è¡Œé˜Ÿåˆ—å¤±å»äº†å¹¶è¡Œçš„èƒ½åŠ›. </p>
<pre><code>//å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ åŒæ­¥ä»»åŠ¡
- (void)test3 {
    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_sync(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]);
        sleep(5);
    });

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_sync(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]);
    });

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_sync(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]);
    });
}
</code></pre><h3 id="GCD-å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><a href="#GCD-å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="GCD å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡"></a>GCD å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡</h3><p>è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥åˆ›å»ºè‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡. è™½ç„¶å¼‚æ­¥ä»»åŠ¡ä¼šæ–°å¼€çº¿ç¨‹, ä½†æ˜¯ç”±äºæ˜¯åœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­æ‰§è¡Œ, æ‰€ä»¥ä¸æ–°å¼€çº¿ç¨‹, æ‰€æœ‰ä»»åŠ¡å‰ä¸€ä¸ªæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œä¸‹ä¸€ä¸ª.</p>
<pre><code>- (void)test4 {
    dispatch_queue_t queue = dispatch_queue_create(&quot;test4&quot;, NULL);

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_async(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]);
        sleep(5);
    });

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_async(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]);
    });

    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡
    dispatch_async(queue, ^{
        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]);
    });
}
</code></pre><h3 id="GCDç›‘å¬å¹¶è¡Œé˜Ÿåˆ—ä¸­å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆ"><a href="#GCDç›‘å¬å¹¶è¡Œé˜Ÿåˆ—ä¸­å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆ" class="headerlink" title="GCDç›‘å¬å¹¶è¡Œé˜Ÿåˆ—ä¸­å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆ"></a>GCDç›‘å¬å¹¶è¡Œé˜Ÿåˆ—ä¸­å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆ</h3><p>åˆ†ç»„æ¨¡å¼ <code>dispatch_group_notify</code>. å¯ä»¥å¼‚æ­¥æ‰§è¡Œå¤šä¸ªè€—æ—¶æ“ä½œ. ç­‰è€—æ—¶æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šå›åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œ, ä¸»è¦ç”¨äºç›‘å¬ä»»åŠ¡æ˜¯å¦å®Œæˆ. ä¸»è¦æœ‰ä¸¤ç§ç”¨æ³•: </p>
<p>ç¬¬ä¸€ç§ç”¨æ³•æ˜¯é€šè¿‡<code>dispatch_group_async</code>, é¦–å…ˆåˆ›å»ºä¸€ä¸ªå…¨å±€å¹¶è¡Œé˜Ÿåˆ—å’Œä¸€ä¸ªgroupé˜Ÿåˆ—ç»„, å†æ¬¡åˆ›å»ºå¼‚æ­¥groupä»»åŠ¡åŠ å…¥åˆ°å‰é¢åˆ›å»ºçš„groupé˜Ÿåˆ—ä¸­å». å½“æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡å®Œæˆå, ä¼šé€šè¿‡<code>dispatch_group_notify</code>å›åˆ°ä¸»çº¿ç¨‹.</p>
<pre><code>- (void)groupTest1 {
    //è·å–å…¨å±€é˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
    //åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ç»„
    dispatch_group_t group = dispatch_group_create();

    dispatch_group_async(group, queue, ^{
        NSLog(@&quot;--- 1 å¼€å§‹--- %@&quot;, [NSThread currentThread]);
        //å»¶æ—¶5ç§’ æ¨¡ä»¿å µå¡å­çº¿ç¨‹
        [NSThread sleepForTimeInterval:5];
        NSLog(@&quot;--- 1 --- å®Œæˆ %@&quot;, [NSThread currentThread]);
    });

    dispatch_group_async(group, queue, ^{
        NSLog(@&quot;--- 2 å¼€å§‹--- %@&quot;, [NSThread currentThread]);
        //å»¶æ—¶5ç§’ æ¨¡ä»¿å µå¡å­çº¿ç¨‹
        [NSThread sleepForTimeInterval:5];
        NSLog(@&quot;--- 2 --- å®Œæˆ %@&quot;, [NSThread currentThread]);
    });

    //åœ¨è¿™ä¸ªé˜Ÿåˆ—ç»„é‡Œé¢ï¼Œä¼šç­‰groupä¸­çš„å…¨éƒ¨ä»£ç æ‰§è¡Œå®Œæ¯•å†å»æ‰§è¡Œå…¶å®ƒçš„æ“ä½œ
    dispatch_group_notify(group, dispatch_get_main_queue(), ^{
        // ç­‰å‰é¢çš„å¼‚æ­¥æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•åï¼Œå›åˆ°ä¸»çº¿ç¨‹...
        NSLog(@&quot;å…¨éƒ¨å®Œæˆ&quot;);
    });
}
</code></pre><p>ç¬¬äºŒç§ç”¨æ³•æ˜¯é€šè¿‡ä¿¡å·é‡<code>dispatch_group_enter</code> å’Œ <code>dispatch_group_leave</code>. åˆ›å»ºä¸€ä¸ªå¹¶è¡Œçº¿ç¨‹å’Œå¤šä¸ªå¼‚æ­¥ä»»åŠ¡, å°†å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°å¹¶è¡Œçº¿ç¨‹ä¸­åŒº. é€šè¿‡<code>dispatch_group_enter</code>æ¥å‘ŠçŸ¥<code>group</code>ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å¼€å§‹,  æœªæ‰§è¡Œå®Œæ¯•ä»»åŠ¡æ•°åŠ 1. åœ¨å¼‚æ­¥çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶, é€šè¿‡<code>dispatch_group_leave</code>å‘ŠçŸ¥group, ä¸€ä¸ªä»»åŠ¡ç»“æŸ, æœªæ‰§è¡Œå®Œæ¯•ä»»åŠ¡æ•°å‡1. å½“æœªæ‰§è¡Œå®Œæ¯•ä»»åŠ¡æ•°ä¸º0çš„æ—¶å€™, è¿™æ—¶groupæ‰è®¤ä¸ºç»„å†…ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•äº†(è¿™ä¸ªå’ŒGCDçš„ä¿¡å·é‡çš„æœºåˆ¶æœ‰äº›ç›¸ä¼¼), è¿™æ—¶å€™æ‰ä¼šå›è°ƒ<code>dispatch_group_notify</code>ä¸­çš„block. æ­¤å¤„éœ€è¦æ³¨æ„, <code>dispatch_group_enter</code>å’Œ<code>dispatch_group_leave</code>çš„æ•°é‡ä¸€å®šè¦ä¸€è‡´. </p>
<pre><code>- (void)groupTest2 {
    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
    dispatch_group_t group = dispatch_group_create();

    dispatch_group_enter(group);
    dispatch_async(queue, ^{
        sleep(2); //è¿™é‡Œçº¿ç¨‹ç¡çœ 1ç§’é’Ÿï¼Œæ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚
        NSLog(@&quot;%@ one finish&quot;, [NSThread currentThread]);
        dispatch_group_leave(group);
    });

    dispatch_group_enter(group);
    dispatch_async(queue, ^{
        sleep(2); //è¿™é‡Œçº¿ç¨‹ç¡çœ 1ç§’é’Ÿï¼Œæ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚
        NSLog(@&quot;%@ two finish&quot;, [NSThread currentThread]);
        dispatch_group_leave(group);
    });

    dispatch_group_notify(group, queue, ^{
        NSLog(@&quot;group finished&quot;);
    });
}
</code></pre><h3 id="GCDå»¶æ—¶æ“ä½œ"><a href="#GCDå»¶æ—¶æ“ä½œ" class="headerlink" title="GCDå»¶æ—¶æ“ä½œ"></a>GCDå»¶æ—¶æ“ä½œ</h3><p>ä½¿ç”¨å¾ˆç®€å•, ä¸¤ä¸ªæ ¸å¿ƒçš„å¯¹è±¡<code>dispatch_time_t</code>å’Œ<code>dispatch_after</code>. å¤§å®¶éƒ½ç»å¸¸ä½¿ç”¨, ä¸ç”¨å¤šè¯´. </p>
<pre><code>- (void)afterTest {
    double delayInSeconds = 2.0;
    dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t) (delayInSeconds * NSEC_PER_SEC));
    //ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨æ—¶é—´, ç¬¬äºŒå„å‚æ•°ä»£è¡¨è¦åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œæ¥ä¸‹æ¥çš„ä»»åŠ¡, ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯ä»»åŠ¡block
    dispatch_after(popTime, dispatch_get_main_queue(), ^(void){
        NSLog(@&quot;%@&quot;, [NSThread currentThread]);
    });
}
</code></pre><h3 id="GCDå•ä¾‹"><a href="#GCDå•ä¾‹" class="headerlink" title="GCDå•ä¾‹"></a>GCDå•ä¾‹</h3><p>è¿™ä¸ªæ›´æ˜¯ä¸ç”¨å¤šè¯´, ç›´æ¥è´´ä¸Šä»£ç .</p>
<pre><code>@interface Tool : NSObject
+ (instancetype)sharedTool;
@end

@implementation Tool
static id _instance;
+ (instancetype)sharedTool {
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        _instance = [[Tool alloc] init];
    });
    return _instance;
}
@end
</code></pre><h3 id="NSOperationçš„ä¼˜å…ˆçº§"><a href="#NSOperationçš„ä¼˜å…ˆçº§" class="headerlink" title="NSOperationçš„ä¼˜å…ˆçº§"></a>NSOperationçš„ä¼˜å…ˆçº§</h3><p>NSOperationQueueä¸­NSOperationå¯¹è±¡çš„æ‰§è¡Œæ–¹å¼æ˜¯æŒ‰ç…§FIFOçš„åŸåˆ™é¡ºåºæ‰§è¡Œ, ä½†æ˜¯å¦‚æœæˆ‘ä»¬è®¾ç½®äº†ä»»åŠ¡çš„ä¼˜å…ˆçº§, é‚£ä¹ˆç³»ç»Ÿå°±ä¼šç»™ä¼˜å…ˆçº§é«˜çš„ä¼˜å…ˆåˆ†é…èµ„æº. </p>
<p>ä¼˜å…ˆçº§ä¸€å…±æœ‰è¿™å‡ ç§, ä»é«˜åˆ°ä½ä¾æ¬¡æ’åˆ—. </p>
<pre><code>typedef NS_ENUM(NSInteger, NSOperationQueuePriority) {
    NSOperationQueuePriorityVeryLow = -8L,
    NSOperationQueuePriorityLow = -4L,
    NSOperationQueuePriorityNormal = 0,
    NSOperationQueuePriorityHigh = 4,
    NSOperationQueuePriorityVeryHigh = 8
};
</code></pre><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹, ä¸‰ä¸ªä»»åŠ¡è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å», è¿™ä¸‰ä¸ªä»»åŠ¡åˆ†åˆ«åœ¨ä¸‰ä¸ªçº¿ç¨‹, äº’ä¸å¹²æ‰°, ç±»ä¼¼äºGCDçš„å¼‚æ­¥å¹¶è¡Œæ¨¡å¼, å¦‚æœæˆ‘ä»¬è®¾ç½®<code>invocationOper.queuePriority = NSOperationQueuePriorityVeryLow</code>ç†è®ºä¸Š, <code>invocationOper</code>ä»»åŠ¡ä¼šåœ¨æœ€åæ‰§è¡Œ, ä½†æ˜¯æˆ‘ä»¬å‘ç°å¹¶æ²¡æœ‰, é‚£æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰è®¾ç½®æœ€å¤§å¹¶å‘æ•°çš„åŸå› , æˆ‘çŒœæµ‹ç³»ç»Ÿå¯èƒ½æ˜¯åšäº†æŸäº›é™åˆ¶, è™½ç„¶æ˜¯æ–°å¼€äº†çº¿ç¨‹, ä½†æ˜¯ç”±äºæœ€å¤§å¹¶å‘æ•°å°äºç­‰äº1å®é™…è¿˜æ˜¯æŒ‰ç…§FIFOé¡ºåºæ‰§è¡Œ, <strong>æ‰€ä»¥æ³¨æ„ä¸€å®šè¦è®¾ç½®æœ€å¤§å¹¶å‘æ•°</strong>.</p>
<pre><code>//æŠŠæ³¨é‡Šæ‰“å¼€å°±å¯ä»¥çœ‹åˆ°æƒ³è¦çš„æ•ˆæœ
- (void)NSOperationQueueRun {
    NSOperationQueue *queue = [[NSOperationQueue alloc] init];
    //queue.maxConcurrentOperationCount = 3;
    NSInvocationOperation *invocationOper = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(invocationOperSel) object:nil];
    //invocationOper.queuePriority = NSOperationQueuePriorityVeryLow;
    [queue addOperation:invocationOper];
    NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@&quot;NSBlockOperationRun_%@&quot;, [NSThread currentThread]);
    }];
    [queue addOperation:blockOper];
    [queue addOperationWithBlock:^{
        NSLog(@&quot;QUEUEBlockOperationRun_%@&quot;, [NSThread currentThread]);
    }];
}

- (void)invocationOperSel {
    NSLog(@&quot;NSInvocationOperationRun_%@&quot;, [NSThread currentThread]);
}
</code></pre><h3 id="NSOperationçš„ä¾èµ–å…³ç³»"><a href="#NSOperationçš„ä¾èµ–å…³ç³»" class="headerlink" title="NSOperationçš„ä¾èµ–å…³ç³»"></a>NSOperationçš„ä¾èµ–å…³ç³»</h3><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—, åˆ†åˆ«åˆ›å»ºè¦æ‰§è¡Œçš„ä»»åŠ¡, <strong>åœ¨æŠŠè¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å»ä¹‹å‰, é€šè¿‡<code>addDependency</code>æ¥å»ºç«‹ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»</strong>. å¦‚æœæˆ‘ä»¬æ²¡æœ‰è®¾ç½®ä¾èµ–çš„è¯, å¦‚æœè®¾ç½®çš„å¹¶å‘æ•°å¤§äº1,  é‚£ä¹ˆ<code>blockOper_1</code>å’Œ<code>`blockOper_2</code>çš„æ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„. å¯æ˜¯å½“æˆ‘ä»¬æ‰§è¡Œ<code>[blockOper_1 addDependency:blockOper_2]</code>æ—¶, å°±ç»™ä¸¤ä¸ªä»»åŠ¡æ·»åŠ äº†ä¾èµ–å…³ç³», <code>blockOper_1</code>æ°¸è¿œåªä¼šåœ¨<code>blockOper_2</code>åæ‰§è¡Œ. å³ä½¿æˆ‘ä»¬ç»™<code>blockOper_1</code>è®¾ç½®äº†æœ€é«˜çš„ä¼˜å…ˆçº§, å› ä¸º<strong>ä¾èµ–çš„ä¼˜å…ˆçº§è¦é«˜äº<code>queuePriority</code></strong>. </p>
<pre><code>- (void)NSOperationQueueRun2 {
    NSOperationQueue *queue = [[NSOperationQueue alloc] init];
//    queue.maxConcurrentOperationCount = 2;
    NSBlockOperation *blockOper_1 = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@&quot;blockOper_1_%@_%@&quot;,@(1),[NSThread currentThread]);
    }];

    NSBlockOperation *blockOper_2 = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@&quot;blockOper_2_%@_%@&quot;,@(2),[NSThread currentThread]);
    }];

//    blockOper_1.queuePriority = NSOperationQueuePriorityVeryHigh;
    [blockOper_1 addDependency:blockOper_2];
    [queue addOperation:blockOper_1];
    [queue addOperation:blockOper_2];
}
</code></pre><h2 id="å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ"><a href="#å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ" class="headerlink" title="å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ"></a>å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ</h2><hr>
<p>å‚è€ƒèµ„æ–™:</p>
<p>1.<a href="http://www.cocoachina.com/ios/20150731/12819.html" target="_blank" rel="external">å…³äºiOSå¤šçº¿ç¨‹, ä½ çœ‹æˆ‘å°±å¤Ÿäº†</a></p>
<p>2.<a href="https://bestswifter.com/multithreadconclusion/" target="_blank" rel="external">iOSå¤šçº¿ç¨‹ç¼–ç¨‹æ€»ç»“</a></p>
<p>3.<a href="http://www.jianshu.com/p/51fd1362249e" target="_blank" rel="external">å…³äºiOSå¤šçº¿ç¨‹, æˆ‘è¯´, ä½ å¬, æ²¡å‡†ä½ å°±æ‡‚äº†</a></p>
<p>4.<a href="http://www.jianshu.com/p/06a18323d9d2" target="_blank" rel="external">æ·±å…¥ç†è§£ GCD</a></p>
<p>5.<a href="http://www.jianshu.com/p/6a6722f12fe3" target="_blank" rel="external">å…³äº iOS å¤šçº¿ç¨‹, éƒ½åœ¨è¿™é‡Œäº†</a></p>
<p>6.<a href="http://blog.csdn.net/mxsgoden/article/details/8821936" target="_blank" rel="external">è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«</a></p>
<p>7.<a href="https://laike9m.com/blog/huan-zai-yi-huo-bing-fa-he-bing-xing,61/" target="_blank" rel="external">å¹¶å‘å’Œå¹¶è¡Œ</a></p>

    
  </div>
</article>

</div>





  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">å…³é—­</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              åšå®¢
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              åˆ†ç±»
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              æ ‡ç­¾
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/Wiki/"
              rel="noopener noreferrer"
              target="_self"
              >
              Wiki
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              å…³äº
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              æœç´¢
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'forsigner';
    
    var disqus_url = 'http://hchong.net/2017/11/21/iOSå¤šçº¿ç¨‹/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//forsigner.disqus.com/count.js" async></script>



    




  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
