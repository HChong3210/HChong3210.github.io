<!DOCTYPE html>


  <html class="light page-post">


<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- ä»£ç å—çš„é«˜äº® -->
  <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/rainbow.min.css">
  <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <!-- <link<! rel="stylesheet" href="/path/to/styles/default.css"> -->
  <!-- <script src="/path/to/highlight.pack.js"></script> -->
  <!-- <script>hljs.initHighlightingOnLoad();</script> -->


  <meta charset="utf-8">
  
  <title>iOSå¤šçº¿ç¨‹ | HChongçš„åšå®¢åœ°å€</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="åŸºç¡€çŸ¥è¯†," />
  

  <meta name="description" content="é¦–å…ˆæˆ‘ä»¬æ¥ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µå’Œä»–ä»¬ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«:  å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ è¿›ç¨‹å’Œçº¿ç¨‹ è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨, è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½. çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“, æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾(èµ„æºåˆ†é…)çš„åŸºæœ¬å•ä½, å®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½. çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥">
<meta name="keywords" content="åŸºç¡€çŸ¥è¯†">
<meta property="og:type" content="article">
<meta property="og:title" content="iOSå¤šçº¿ç¨‹">
<meta property="og:url" content="http://hchong.net/2017/11/21/iOSå¤šçº¿ç¨‹/index.html">
<meta property="og:site_name" content="HChongçš„åšå®¢åœ°å€">
<meta property="og:description" content="é¦–å…ˆæˆ‘ä»¬æ¥ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µå’Œä»–ä»¬ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«:  å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ è¿›ç¨‹å’Œçº¿ç¨‹ è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨, è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½. çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“, æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾(èµ„æºåˆ†é…)çš„åŸºæœ¬å•ä½, å®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½. çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æº, åªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æº(å¦‚ç¨‹åºè®¡æ•°å™¨, ä¸€ç»„å¯„å­˜å™¨å’Œæ ˆ)">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://img.souche.com/f2e/5d7717afde012bbfc557f26bc5eaffea.png">
<meta property="og:image" content="http://img.souche.com/f2e/5b1729532683ad164c061958d5248a66.png">
<meta property="og:image" content="http://img.souche.com/f2e/27086c860f921209238d3f60c2f8722c.png">
<meta property="og:image" content="http://img.souche.com/f2e/9c13eaeac28f7fe7105af2feb878d5ef.png">
<meta property="og:image" content="http://img.souche.com/f2e/43a48f9de1c0bb336215543157ad875b.png">
<meta property="og:image" content="http://img.souche.com/f2e/0d108cba7a737b62e2f5e1be402bc5d0.png">
<meta property="og:updated_time" content="2018-03-24T07:19:02.961Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOSå¤šçº¿ç¨‹">
<meta name="twitter:description" content="é¦–å…ˆæˆ‘ä»¬æ¥ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µå’Œä»–ä»¬ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«:  å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ è¿›ç¨‹å’Œçº¿ç¨‹ è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨, è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½. çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“, æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾(èµ„æºåˆ†é…)çš„åŸºæœ¬å•ä½, å®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½. çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æº, åªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æº(å¦‚ç¨‹åºè®¡æ•°å™¨, ä¸€ç»„å¯„å­˜å™¨å’Œæ ˆ)">
<meta name="twitter:image" content="http://img.souche.com/f2e/5d7717afde012bbfc557f26bc5eaffea.png">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/style.css">
  

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-38189205-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  

</head>

<body>


  
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><span id="toolbox-mobile" class="toolbox-mobile">æˆ³æˆ‘</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">æˆ³æˆ‘</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            åšå®¢
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            åˆ†ç±»
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            æ ‡ç­¾
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            å…³äº
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            æœç´¢
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ"><span class="toc-text">å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ"><span class="toc-text">å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pthresds"><span class="toc-text">Pthresds</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSThread"><span class="toc-text">NSThread</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCD"><span class="toc-text">GCD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSOperation-amp-NSOperationQueue"><span class="toc-text">NSOperation & NSOperationQueue</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NSOperation"><span class="toc-text">NSOperation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NSOperationQueue"><span class="toc-text">NSOperationQueue</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¸¸è§çš„ä½¿ç”¨æ–¹å¼"><span class="toc-text">å¸¸è§çš„ä½¿ç”¨æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><span class="toc-text">GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><span class="toc-text">GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡"><span class="toc-text">GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCD-å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><span class="toc-text">GCD å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dispatch-Group"><span class="toc-text">Dispatch Group</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDå»¶æ—¶æ“ä½œ-dispatch-after"><span class="toc-text">GCDå»¶æ—¶æ“ä½œ(dispatch_after)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDå•ä¾‹-dispatch-once"><span class="toc-text">GCDå•ä¾‹(dispatch_once)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCD-çº¿ç¨‹é—´çš„é€šè®¯"><span class="toc-text">GCD çº¿ç¨‹é—´çš„é€šè®¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDé‡å¤æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡-dispatch-apply"><span class="toc-text">GCDé‡å¤æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡(dispatch_apply)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDè®¾ç½®ä¼˜å…ˆçº§-dispatch-set-target-queue"><span class="toc-text">GCDè®¾ç½®ä¼˜å…ˆçº§(dispatch_set_target_queue)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDæ …æ -dispatch-barrier-async"><span class="toc-text">GCDæ …æ (dispatch_barrier_async)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDä¿¡å·é‡-dispatch-semaphore-t"><span class="toc-text">GCDä¿¡å·é‡(dispatch_semaphore_t)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCDå®šæ—¶å™¨"><span class="toc-text">GCDå®šæ—¶å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSOperationçš„ä¼˜å…ˆçº§"><span class="toc-text">NSOperationçš„ä¼˜å…ˆçº§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSOperationçš„ä¾èµ–å…³ç³»"><span class="toc-text">NSOperationçš„ä¾èµ–å…³ç³»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ"><span class="toc-text">å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ¡ˆä¾‹ä¸€"><span class="toc-text">æ¡ˆä¾‹ä¸€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ¡ˆä¾‹äºŒ"><span class="toc-text">æ¡ˆä¾‹äºŒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ¡ˆä¾‹ä¸‰"><span class="toc-text">æ¡ˆä¾‹ä¸‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ¡ˆä¾‹å››"><span class="toc-text">æ¡ˆä¾‹å››</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ¡ˆä¾‹äº”"><span class="toc-text">æ¡ˆä¾‹äº”</span></a></li></ol></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-iOSå¤šçº¿ç¨‹" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">iOSå¤šçº¿ç¨‹</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.11.21</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>HChong</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/åŸºç¡€çŸ¥è¯†/">åŸºç¡€çŸ¥è¯†</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbspçƒ­åº¦ <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>â„ƒ
        </span>
      
    </div>
  </header>

  <div class="article-content">
    
      <p>é¦–å…ˆæˆ‘ä»¬æ¥ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µå’Œä»–ä»¬ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«: </p>
<h2 id="å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ"><a href="#å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ" class="headerlink" title="å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ"></a>å¤šçº¿ç¨‹å¼€å‘å¸¸ç”¨æ¦‚å¿µ</h2><ol>
<li><p>è¿›ç¨‹å’Œçº¿ç¨‹<br> è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨, è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½.<br> çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“, æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾(èµ„æºåˆ†é…)çš„åŸºæœ¬å•ä½, å®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½. çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æº, åªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æº(å¦‚ç¨‹åºè®¡æ•°å™¨, ä¸€ç»„å¯„å­˜å™¨å’Œæ ˆ), ä½†æ˜¯å®ƒå¯ä¸åŒå±ä¸€ä¸ªè¿›ç¨‹çš„å…¶ä»–çš„çº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æº.<br> ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå’Œæ’¤é”€å¦ä¸€ä¸ªçº¿ç¨‹; åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œ.<br> è¿›ç¨‹å’Œçº¿ç¨‹çš„ä¸»è¦å·®åˆ«åœ¨äºå®ƒä»¬æ˜¯ä¸åŒçš„æ“ä½œç³»ç»Ÿèµ„æºç®¡ç†æ–¹å¼. è¿›ç¨‹æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´, ä¸€ä¸ªè¿›ç¨‹å´©æºƒå, åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹äº§ç”Ÿå½±å“. è€Œçº¿ç¨‹åªæ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒæ‰§è¡Œè·¯å¾„. çº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡, ä½†çº¿ç¨‹ä¹‹é—´æ²¡æœ‰å•ç‹¬çš„åœ°å€ç©ºé—´, ä¸€ä¸ªçº¿ç¨‹æ­»æ‰å°±ç­‰äºæ•´ä¸ªè¿›ç¨‹æ­»æ‰, æ‰€ä»¥å¤šè¿›ç¨‹çš„ç¨‹åºè¦æ¯”å¤šçº¿ç¨‹çš„ç¨‹åºå¥å£®, ä½†åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶, è€—è´¹èµ„æºè¾ƒå¤§, æ•ˆç‡è¦å·®ä¸€äº›. ä½†å¯¹äºä¸€äº›è¦æ±‚åŒæ—¶è¿›è¡Œå¹¶ä¸”åˆè¦å…±äº«æŸäº›å˜é‡çš„å¹¶å‘æ“ä½œ, åªèƒ½ç”¨çº¿ç¨‹, ä¸èƒ½ç”¨è¿›ç¨‹. </p>
<ul>
<li>ç®€è€Œè¨€ä¹‹, ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹, ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹.</li>
<li>çº¿ç¨‹çš„åˆ’åˆ†å°ºåº¦å°äºè¿›ç¨‹, ä½¿å¾—å¤šçº¿ç¨‹ç¨‹åºçš„å¹¶å‘æ€§é«˜. </li>
<li>å¦å¤–, è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜å•å…ƒ, è€Œå¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜, ä»è€Œæå¤§åœ°æé«˜äº†ç¨‹åºçš„è¿è¡Œæ•ˆç‡. </li>
<li>çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸è¿›ç¨‹è¿˜æ˜¯æœ‰åŒºåˆ«çš„. æ¯ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æœ‰ä¸€ä¸ªç¨‹åºè¿è¡Œçš„å…¥å£, é¡ºåºæ‰§è¡Œåºåˆ—å’Œç¨‹åºçš„å‡ºå£. ä½†æ˜¯çº¿ç¨‹ä¸èƒ½å¤Ÿç‹¬ç«‹æ‰§è¡Œ, å¿…é¡»ä¾å­˜åœ¨åº”ç”¨ç¨‹åºä¸­, ç”±åº”ç”¨ç¨‹åºæä¾›å¤šä¸ªçº¿ç¨‹æ‰§è¡Œæ§åˆ¶. </li>
<li><p>ä»é€»è¾‘è§’åº¦æ¥çœ‹, å¤šçº¿ç¨‹çš„æ„ä¹‰åœ¨äºä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­, æœ‰å¤šä¸ªæ‰§è¡Œéƒ¨åˆ†å¯ä»¥åŒæ—¶æ‰§è¡Œ. ä½†æ“ä½œç³»ç»Ÿå¹¶æ²¡æœ‰å°†å¤šä¸ªçº¿ç¨‹çœ‹åšå¤šä¸ªç‹¬ç«‹çš„åº”ç”¨, æ¥å®ç°è¿›ç¨‹çš„è°ƒåº¦å’Œç®¡ç†ä»¥åŠèµ„æºåˆ†é…. è¿™å°±æ˜¯è¿›ç¨‹å’Œçº¿ç¨‹çš„é‡è¦åŒºåˆ«.</p>
<p>æ‰“ä¸ªæ¯”æ–¹, å¤šè¿›ç¨‹å°±å¥½æ¯”åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åº. æ¯”å¦‚åŒæ—¶è¿è¡ŒQQ, éŸ³ä¹æ’­æ”¾å™¨, ä»¥åŠæµè§ˆå™¨. å¤šçº¿ç¨‹å°±æ˜¯åŒä¸€æ—¶åˆ»æ‰§è¡Œå¤šä¸ªçº¿ç¨‹, ç”¨æµè§ˆå™¨ä¸€è¾¹ä¸‹è½½, ä¸€è¾¹å¬æ­Œ, ä¸€è¾¹çœ‹è§†é¢‘, ä¸€è¾¹çœ‹ç½‘é¡µ. æµè§ˆå™¨è¿™ä¸ªè¿›ç¨‹ä¸‹æœ‰å¤šä¸ªçº¿ç¨‹, è¿™äº›çº¿ç¨‹å…±äº«ç³»ç»Ÿåˆ†é…ç»™æµè§ˆå™¨è¿™ä¸ªè¿›ç¨‹çš„èµ„æº, æ‰€ä»¥å„ä¸ªçº¿ç¨‹ä¹‹é—´å¯å¾ˆæ–¹ä¾¿çš„é€šä¿¡, ä¸€ä¸ªçº¿ç¨‹æ­»äº†, ä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œ. å¦‚æœæµè§ˆå™¨è¿™ä¸ªè¿›ç¨‹æ­»äº†, é‚£ä¹ˆä»–ä¸‹é¢çš„æ‰€æœ‰çº¿ç¨‹å°±éƒ½ç”¨ä¸äº†äº†. æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨æ‰“å¼€QQè¿™é‡Œå°±æ˜¯è¿›ç¨‹é—´é€šä¿¡, ç”±äºä¸åŒçš„è¿›ç¨‹ç³»ç»Ÿèµ„æºä¸åŒ, æ‰€ä»¥è¿›ç¨‹é—´çš„é€šä¿¡ä¸æ˜¯å¾ˆå®¹æ˜“å®ç°. å¹¶ä¸”åˆ‡æ¢è¿›ç¨‹ä¼šæœ‰æ€§èƒ½é—®é¢˜.</p>
</li>
</ul>
</li>
<li><p>å¹¶å‘å’Œå¹¶è¡Œ<br> å¹¶å‘æŒ‡èƒ½å¤Ÿè®©å¤šä¸ªä»»åŠ¡åœ¨é€»è¾‘ä¸Šäº¤ç»‡æ‰§è¡Œçš„ç¨‹åºè®¾è®¡, ä½†å¹¶å‘äº‹ä»¶ä¹‹é—´ä¸ä¸€å®šè¦åŒä¸€æ—¶åˆ»å‘ç”Ÿ. å¹¶è¡ŒæŒ‡çš„æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„çŠ¶æ€æ˜¯ç‰©ç†ä¸ŠåŒæ—¶æ‰§è¡Œ, æ˜¯æŒ‡åŒæ—¶å‘ç”Ÿçš„ä¸¤ä¸ªå¹¶å‘äº‹ä»¶, å…·æœ‰å¹¶å‘çš„å«ä¹‰, è€Œå¹¶å‘åˆ™ä¸ä¸€å®šå¹¶è¡Œ.<br> å¹¶å‘æ˜¯ä¸€ç§ç°è±¡, é¢å¯¹è¿™ä¸€ç°è±¡, æˆ‘ä»¬é¦–å…ˆåˆ›å»ºå¤šä¸ªçº¿ç¨‹. çœŸæ­£åŠ å¿«ç¨‹åºè¿è¡Œé€Ÿåº¦çš„, æ˜¯å¹¶è¡ŒæŠ€æœ¯. ä¹Ÿå°±æ˜¯è®©å¤šä¸ªCPUåŒæ—¶å·¥ä½œ. è€Œå¤šçº¿ç¨‹, æ˜¯ä¸ºäº†è®©å¤šä¸ªCPUåŒæ—¶å·¥ä½œæˆä¸ºå¯èƒ½. å¹¶å‘è®¾è®¡è®©å¹¶å‘æ‰§è¡Œæˆä¸ºå¯èƒ½, è€Œå¹¶è¡Œæ˜¯å¹¶å‘æ‰§è¡Œçš„ä¸€ç§æ¨¡å¼.<br> å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«å°±æ˜¯ä¸€ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´å’Œä¸‰ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´. ä¸€ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´ä½†æ˜¯åŒä¸€æ—¶é—´åªèƒ½å•ƒä¸€ä¸ªé¦’å¤´, ä¸‰ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´, ä¸‰ä¸ªé¦’å¤´åŒä¸€æ—¶é—´éƒ½ä¼šè¢«å•ƒ.<br> ä¸‹å›¾åæ˜ äº†ä¸€ä¸ªåŒ…å«8ä¸ªæ“ä½œçš„ä»»åŠ¡åœ¨ä¸€ä¸ªæœ‰ä¸¤æ ¸å¿ƒçš„CPUä¸­åˆ›å»ºå››ä¸ªçº¿ç¨‹è¿è¡Œçš„æƒ…å†µ. å‡è®¾æ¯ä¸ªæ ¸å¿ƒæœ‰ä¸¤ä¸ªçº¿ç¨‹, é‚£ä¹ˆæ¯ä¸ªCPUä¸­ä¸¤ä¸ªçº¿ç¨‹ä¼šäº¤æ›¿å¹¶å‘, ä¸¤ä¸ªCPUä¹‹é—´çš„æ“ä½œä¼šå¹¶è¡Œè¿ç®—. å°±CPU1è€Œè¨€è™½ç„¶å®ç°äº†å¹¶å‘ä½†æ˜¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨è¿›è¡Œ, CPUåªæ˜¯å¿«é€Ÿçš„åœ¨ä»»åŠ¡ä¹‹é—´åˆ‡æ¢, CPU1å’ŒCPU2æ•´ä½“æ¥çœ‹æ˜¯å¹¶è¡Œå…ƒç®—, åŒä¸€æ—¶é—´æ˜¯æœ‰å¤šä¸ªä»»åŠ¡åœ¨è¿›è¡Œ. å•å°±ä¸€ä¸ªCPUè€Œè¨€ä¸¤ä¸ªçº¿ç¨‹å¯ä»¥è§£å†³çº¿ç¨‹é˜»å¡é€ æˆçš„ä¸æµç•…é—®é¢˜, å…¶æœ¬èº«è¿è¡Œæ•ˆç‡å¹¶æ²¡æœ‰æé«˜. å¤šCPUçš„å¹¶è¡Œè¿ç®—æ‰çœŸæ­£è§£å†³äº†è¿è¡Œæ•ˆç‡é—®é¢˜, è¿™ä¹Ÿæ­£æ˜¯å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«. </p>
<p>  <img src="http://img.souche.com/f2e/5d7717afde012bbfc557f26bc5eaffea.png" alt="å¹¶å‘å’Œå¹¶è¡Œ"></p>
<p> æ³¨æ„: å¹¶è¡Œå’Œä¸²è¡Œæ˜¯ç›¸å¯¹åº”çš„. ä¸²è¡Œåœ¨ç‰©ç†å±‚é¢ä¸ŠåŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨è¿›è¡Œ.</p>
</li>
<li><p>åŒæ­¥å’Œå¼‚æ­¥<br> åŒæ­¥åœ¨å‘å‡ºä¸€ä¸ªåŒæ­¥è°ƒç”¨æ—¶, åœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰, è¯¥è°ƒç”¨å°±ä¸è¿”å›. å¤šä¸ªä»»åŠ¡æƒ…å†µä¸‹, ä¸€ä¸ªä»»åŠ¡Aæ‰§è¡Œç»“æŸ, æ‰å¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªä»»åŠ¡B. åªå­˜åœ¨ä¸€ä¸ªçº¿ç¨‹. å¼‚æ­¥åœ¨å‘å‡ºä¸€ä¸ªå¼‚æ­¥è°ƒç”¨å, è°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœ, è¯¥è°ƒç”¨å°±è¿”å›äº†. å¤šä¸ªä»»åŠ¡æƒ…å†µä¸‹, ä¸€ä¸ªä»»åŠ¡Aæ­£åœ¨æ‰§è¡Œ, åŒæ—¶å¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªä»»åŠ¡B. ä»»åŠ¡Bä¸ç”¨ç­‰å¾…ä»»åŠ¡Aç»“æŸæ‰æ‰§è¡Œ. å­˜åœ¨å¤šæ¡çº¿ç¨‹. </p>
</li>
</ol>
<h2 id="å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ"><a href="#å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ" class="headerlink" title="å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ"></a>å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆ</h2><p>åœ¨iOSå¼€å‘ä¸­å¸¸è§çš„å¤šçº¿ç¨‹æ–¹æ¡ˆä¸€å…±æœ‰4å¥—, åˆ†åˆ«æ˜¯<code>Pthreads</code>, <code>NSThread</code>, <code>GCD</code>, <code>NSOperation &amp; NSOperationQueue</code>. å‰ä¸¤ç§ä¸æ€ä¹ˆå¸¸ç”¨, è¿™é‡Œå°±ç®€å•çš„ä»‹ç»ä¸€ä¸‹, ç€é‡ä»‹ç»åä¸¤ç§. </p>
<h3 id="Pthresds"><a href="#Pthresds" class="headerlink" title="Pthresds"></a>Pthresds</h3><p>POSIXçº¿ç¨‹(POSIX threads), ç®€ç§°Pthreads, æ˜¯çº¿ç¨‹çš„POSIXæ ‡å‡†. è¯¥æ ‡å‡†å®šä¹‰äº†åˆ›å»ºå’Œæ“çºµçº¿ç¨‹çš„ä¸€æ•´å¥—API, åœ¨ç±»Unixæ“ä½œç³»ç»Ÿ(Unixã€Linuxã€Mac OSXç­‰)ä¸­, éƒ½ä½¿ç”¨Pthreadsä½œä¸ºæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹. é‚£ä¹Ÿå°±æ„å‘³ç€å¯ä»¥è·¨å¹³å°ä½¿ç”¨, ä½†æ˜¯ä½¿ç”¨èµ·æ¥ç‰¹åˆ«é…¸çˆ½. ğŸ™‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">#import &lt;pthread.h&gt;</div><div class="line"></div><div class="line">- (void)pthreadsDoTask &#123;</div><div class="line">    /*</div><div class="line">     pthread_tï¼šçº¿ç¨‹æŒ‡é’ˆ</div><div class="line">     pthread_attr_tï¼šçº¿ç¨‹å±æ€§</div><div class="line">     pthread_mutex_tï¼šäº’æ–¥å¯¹è±¡</div><div class="line">     pthread_mutexattr_tï¼šäº’æ–¥å±æ€§å¯¹è±¡</div><div class="line">     pthread_cond_tï¼šæ¡ä»¶å˜é‡</div><div class="line">     pthread_condattr_tï¼šæ¡ä»¶å±æ€§å¯¹è±¡</div><div class="line">     pthread_key_tï¼šçº¿ç¨‹æ•°æ®é”®</div><div class="line">     pthread_rwlock_tï¼šè¯»å†™é”</div><div class="line">     //</div><div class="line">     pthread_create()ï¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹</div><div class="line">     pthread_exit()ï¼šç»ˆæ­¢å½“å‰çº¿ç¨‹</div><div class="line">     pthread_cancel()ï¼šä¸­æ–­å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„è¿è¡Œ</div><div class="line">     pthread_join()ï¼šé˜»å¡å½“å‰çš„çº¿ç¨‹, ç›´åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿è¡Œç»“æŸ</div><div class="line">     pthread_attr_init()ï¼šåˆå§‹åŒ–çº¿ç¨‹çš„å±æ€§</div><div class="line">     pthread_attr_setdetachstate()ï¼šè®¾ç½®è„±ç¦»çŠ¶æ€çš„å±æ€§ï¼ˆå†³å®šè¿™ä¸ªçº¿ç¨‹åœ¨ç»ˆæ­¢æ—¶æ˜¯å¦å¯ä»¥è¢«ç»“åˆï¼‰</div><div class="line">     pthread_attr_getdetachstate()ï¼šè·å–è„±ç¦»çŠ¶æ€çš„å±æ€§</div><div class="line">     pthread_attr_destroy()ï¼šåˆ é™¤çº¿ç¨‹çš„å±æ€§</div><div class="line">     pthread_kill()ï¼šå‘çº¿ç¨‹å‘é€ä¸€ä¸ªä¿¡å·</div><div class="line">     pthread_equal(): å¯¹ä¸¤ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ ‡è¯†å·è¿›è¡Œæ¯”è¾ƒ</div><div class="line">     pthread_detach(): åˆ†ç¦»çº¿ç¨‹</div><div class="line">     pthread_self(): æŸ¥è¯¢çº¿ç¨‹è‡ªèº«çº¿ç¨‹æ ‡è¯†å·</div><div class="line">     //</div><div class="line">     *åˆ›å»ºçº¿ç¨‹</div><div class="line">     int pthread_create(pthread_t _Nullable * _Nonnull __restrict, //æŒ‡å‘æ–°å»ºçº¿ç¨‹æ ‡è¯†ç¬¦çš„æŒ‡é’ˆ</div><div class="line">     const pthread_attr_t * _Nullable __restrict,  //è®¾ç½®çº¿ç¨‹å±æ€§. é»˜è®¤å€¼NULL. </div><div class="line">     void * _Nullable (* _Nonnull)(void * _Nullable),  //è¯¥çº¿ç¨‹è¿è¡Œå‡½æ•°çš„åœ°å€</div><div class="line">     void * _Nullable __restrict);  //è¿è¡Œå‡½æ•°æ‰€éœ€çš„å‚æ•°</div><div class="line">     *è¿”å›å€¼ï¼š</div><div class="line">     *è‹¥çº¿ç¨‹åˆ›å»ºæˆåŠŸ, åˆ™è¿”å›0</div><div class="line">     *è‹¥çº¿ç¨‹åˆ›å»ºå¤±è´¥, åˆ™è¿”å›å‡ºé”™ç¼–å·</div><div class="line">     */</div><div class="line">    </div><div class="line">    //</div><div class="line">    pthread_t thread = NULL;</div><div class="line">    NSString *params = @&quot;Hello World&quot;;</div><div class="line">    int result = pthread_create(&amp;thread, NULL, threadTask, (__bridge void *)(params));</div><div class="line">    result == 0 ? NSLog(@&quot;creat thread success&quot;) : NSLog(@&quot;creat thread failure&quot;);</div><div class="line">    //è®¾ç½®å­çº¿ç¨‹çš„çŠ¶æ€è®¾ç½®ä¸ºdetached,åˆ™è¯¥çº¿ç¨‹è¿è¡Œç»“æŸåä¼šè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰èµ„æº</div><div class="line">    pthread_detach(thread);</div><div class="line">&#125;</div><div class="line"></div><div class="line">void *threadTask(void *params) &#123;</div><div class="line">    NSLog(@&quot;%@ - %@&quot;, [NSThread currentThread], (__bridge NSString *)(params));</div><div class="line">    return NULL;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çœ‹ä¸‹è¿™äº›APIè®¾è®¡å¯ä»¥è¯´æ˜¯ç›¸å½“ä¸å‹å¥½, å¹¶ä¸”éœ€è¦æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹çš„å„ä¸ªçŠ¶æ€çš„è½¬æ¢å’Œç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†.</p>
<h3 id="NSThread"><a href="#NSThread" class="headerlink" title="NSThread"></a>NSThread</h3><p><code>NSThread</code>çš„APIè®¾è®¡å¤§è‡´å¦‚ä¸‹: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@interface NSThread : NSObject</div><div class="line">//å½“å‰çº¿ç¨‹</div><div class="line">@property (class, readonly, strong) NSThread *currentThread;</div><div class="line">//ä½¿ç”¨ç±»æ–¹æ³•åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</div><div class="line">+ (void)detachNewThreadWithBlock:(void (^)(void))block API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));</div><div class="line">+ (void)detachNewThreadSelector:(SEL)selector toTarget:(id)target withObject:(nullable id)argument;</div><div class="line">//åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºå¤šçº¿ç¨‹</div><div class="line">+ (BOOL)isMultiThreaded;</div><div class="line">//æŒ‡å®šçº¿ç¨‹çš„çº¿ç¨‹å‚æ•°, ä¾‹å¦‚è®¾ç½®å½“å‰çº¿ç¨‹çš„æ–­è¨€å¤„ç†å™¨. </div><div class="line">@property (readonly, retain) NSMutableDictionary *threadDictionary;</div><div class="line">//å½“å‰çº¿ç¨‹æš‚åœåˆ°æŸä¸ªæ—¶é—´</div><div class="line">+ (void)sleepUntilDate:(NSDate *)date;</div><div class="line">//å½“å‰çº¿ç¨‹æš‚åœä¸€æ®µæ—¶é—´</div><div class="line">+ (void)sleepForTimeInterval:(NSTimeInterval)ti;</div><div class="line">//é€€å‡ºå½“å‰çº¿ç¨‹</div><div class="line">+ (void)exit;</div><div class="line">//å½“å‰çº¿ç¨‹ä¼˜å…ˆçº§</div><div class="line">+ (double)threadPriority;</div><div class="line">//è®¾ç½®å½“å‰çº¿ç¨‹ä¼˜å…ˆçº§</div><div class="line">+ (BOOL)setThreadPriority:(double)p;</div><div class="line">//æŒ‡å®šçº¿ç¨‹å¯¹è±¡ä¼˜å…ˆçº§ 0.0ï½1.0, é»˜è®¤å€¼ä¸º0.5</div><div class="line">@property double threadPriority NS_AVAILABLE(10_6, 4_0);</div><div class="line">//æœåŠ¡è´¨é‡</div><div class="line">@property NSQualityOfService qualityOfService NS_AVAILABLE(10_10, 8_0);</div><div class="line">//çº¿ç¨‹åç§°</div><div class="line">@property (nullable, copy) NSString *name NS_AVAILABLE(10_5, 2_0);</div><div class="line">//æ ˆåŒºå¤§å°</div><div class="line">@property NSUInteger stackSize NS_AVAILABLE(10_5, 2_0);</div><div class="line">//æ˜¯å¦ä¸ºä¸»çº¿ç¨‹</div><div class="line">@property (class, readonly) BOOL isMainThread NS_AVAILABLE(10_5, 2_0);</div><div class="line">//è·å–ä¸»çº¿ç¨‹</div><div class="line">@property (class, readonly, strong) NSThread *mainThread NS_AVAILABLE(10_5, 2_0);</div><div class="line">//åˆå§‹åŒ–</div><div class="line">- (instancetype)init NS_AVAILABLE(10_5, 2_0) NS_DESIGNATED_INITIALIZER;</div><div class="line">//å®ä¾‹æ–¹æ³•åˆå§‹åŒ–, éœ€è¦å†è°ƒç”¨startæ–¹æ³•</div><div class="line">- (instancetype)initWithTarget:(id)target selector:(SEL)selector object:(nullable id)argument NS_AVAILABLE(10_5, 2_0);</div><div class="line">- (instancetype)initWithBlock:(void (^)(void))block API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));</div><div class="line">//çº¿ç¨‹çŠ¶æ€, æ­£åœ¨æ‰§è¡Œ</div><div class="line">@property (readonly, getter=isExecuting) BOOL executing NS_AVAILABLE(10_5, 2_0);</div><div class="line">//çº¿ç¨‹çŠ¶æ€, æ­£åœ¨å®Œæˆ</div><div class="line">@property (readonly, getter=isFinished) BOOL finished NS_AVAILABLE(10_5, 2_0);</div><div class="line">//çº¿ç¨‹çŠ¶æ€, å·²ç»å–æ¶ˆ</div><div class="line">@property (readonly, getter=isCancelled) BOOL cancelled NS_AVAILABLE(10_5, 2_0);</div><div class="line">//å–æ¶ˆ, ä»…ä»…æ”¹å˜çº¿ç¨‹çŠ¶æ€, å¹¶ä¸èƒ½åƒexistä¸€æ ·çœŸæ­£çš„ç»ˆæ­¢çº¿ç¨‹</div><div class="line">- (void)cancel NS_AVAILABLE(10_5, 2_0);</div><div class="line">//å¼€å§‹</div><div class="line">- (void)start NS_AVAILABLE(10_5, 2_0);</div><div class="line">//çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„ä»£ç , ä¸€èˆ¬å†™å­ç±»çš„æ—¶å€™ä¼šç”¨åˆ°</div><div class="line">- (void)main NS_AVAILABLE(10_5, 2_0);</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ä¸ªNSObjectçš„åˆ†ç±»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@interface NSObject (NSThreadPerformAdditions)</div><div class="line">//éšå¼çš„åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹, å¹¶åœ¨æŒ‡å®šçš„çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹æˆ–å­çº¿ç¨‹ï¼‰ä¸Šæ‰§è¡Œæ–¹æ³•. </div><div class="line">- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait modes:(nullable NSArray&lt;NSString *&gt; *)array;</div><div class="line">- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait;</div><div class="line">- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait modes:(nullable NSArray&lt;NSString *&gt; *)array NS_AVAILABLE(10_5, 2_0);</div><div class="line">- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait NS_AVAILABLE(10_5, 2_0);</div><div class="line">- (void)performSelectorInBackground:(SEL)aSelector withObject:(nullable id)arg NS_AVAILABLE(10_5, 2_0);</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>å¸¸è§çš„ç”¨æ³•æœ‰ä»¥ä¸‹å‡ ç§: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void) startThread &#123;</div><div class="line"></div><div class="line">    //åˆ›å»ºå¹¶ä¸”æ‰‹åŠ¨å¯åŠ¨</div><div class="line">    NSThread *thread = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil];</div><div class="line">    [thread start];</div><div class="line"></div><div class="line">    //ç±»æ–¹æ³•åˆ›å»ºå¹¶ä¸”è‡ªåŠ¨å¯åŠ¨</div><div class="line">    [NSThread detachNewThreadSelector:@selector(run) toTarget:self withObject:nil];</div><div class="line"></div><div class="line">    //é€šè¿‡NSObjectçš„æ–¹æ³•è‡ªåŠ¨å¯åŠ¨</div><div class="line">    [self performSelectorInBackground:@selector(run) withObject:nil];</div><div class="line">&#125;    </div><div class="line"></div><div class="line">- (void)run &#123;</div><div class="line">    NSLog(@&quot;%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h3><p>Grand Central Dispatch, å®ƒæ˜¯è‹¹æœä¸ºå¤šæ ¸çš„å¹¶è¡Œè¿ç®—æå‡ºçš„è§£å†³æ–¹æ¡ˆ, ä¼šè‡ªåŠ¨åˆç†åœ°åˆ©ç”¨æ›´å¤šçš„CPUå†…æ ¸(æ¯”å¦‚åŒæ ¸ã€å››æ ¸), æœ€é‡è¦çš„æ˜¯å®ƒä¼šè‡ªåŠ¨ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ(åˆ›å»ºçº¿ç¨‹ã€è°ƒåº¦ä»»åŠ¡ã€é”€æ¯çº¿ç¨‹), å®Œå…¨ä¸éœ€è¦æˆ‘ä»¬ç®¡ç†, æˆ‘ä»¬åªéœ€è¦å‘Šè¯‰å¹²ä»€ä¹ˆå°±è¡Œ. åŒæ—¶å®ƒä½¿ç”¨çš„ä¹Ÿæ˜¯Cè¯­è¨€, ä¸è¿‡ç”±äºä½¿ç”¨äº†Block(Swifté‡Œå«åšé—­åŒ…), ä½¿å¾—ä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿, è€Œä¸”çµæ´».</p>
<p>äº†è§£GCDæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸¤ä¸ªæ¦‚å¿µ, <strong><code>é˜Ÿåˆ—</code></strong>å’Œ<strong><code>ä»»åŠ¡</code></strong>.</p>
<ol>
<li><p>ä»»åŠ¡<br>è¦æ‰§è¡Œçš„æ“ä½œæˆ–æ–¹æ³•å‡½æ•°. åœ¨GCDä¸­æŒ‡çš„å°±æ˜¯blockå—, åœ¨NSThreadä¸­æŒ‡çš„æ˜¯<code>performSelector:</code>ä¸­çš„æ–¹æ³•. åŠ å…¥ä»»åŠ¡æ—¶æœ‰ä¸¤ç§å½¢å¼: <code>åŒæ­¥ä»»åŠ¡(dispatch_sync)</code>å’Œ<code>å¼‚æ­¥ä»»åŠ¡(dispatch_async)</code>.</p>
<ul>
<li><p>åŒæ­¥ä»»åŠ¡: ä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹, ä¼šé˜»å¡å½“å‰çº¿ç¨‹. å®Œæˆéœ€è¦åšçš„ä»»åŠ¡åæ‰ä¼šè¿”å›, è¿›è¡Œä¸‹ä¸€ä»»åŠ¡. åˆ›å»ºæ–¹å¼ä¸º:</p>
  <figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//æŠŠå³è¾¹çš„å‚æ•°(ä»»åŠ¡)æäº¤ç»™å·¦è¾¹çš„å‚æ•°(é˜Ÿåˆ—)è¿›è¡Œæ‰§è¡Œ</div><div class="line">dispatch_sync(dispatch_queue_t queue, dispatch_block_t block);</div></pre></td></tr></table></figure>
</li>
<li><p>å¼‚æ­¥ä»»åŠ¡: ä¸ä¼šç­‰å¾…ä»»åŠ¡å®Œæˆæ‰è¿”å›, ä¼šç«‹å³è¿”å›. å¼‚æ­¥æ˜¯å¤šçº¿ç¨‹çš„ä»£åè¯, å› ä¸ºå¿…å®šä¼šå¼€å¯æ–°çš„çº¿ç¨‹, çº¿ç¨‹çš„ç”³è¯·æ˜¯ç”±å¼‚æ­¥è´Ÿè´£, èµ·åˆ°å¼€åˆ†æ”¯çš„ä½œç”¨. åˆ›å»ºæ–¹å¼ä¸º:</p>
  <figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//æŠŠå³è¾¹çš„å‚æ•°(ä»»åŠ¡)æäº¤ç»™å·¦è¾¹çš„å‚æ•°(é˜Ÿåˆ—)è¿›è¡Œæ‰§è¡Œ</div><div class="line">dispatch_async(dispatch_queue_t queue, dispatch_block_t block);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>é˜Ÿåˆ—<br>å­˜æ”¾ä»»åŠ¡çš„é›†åˆ, æˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ç„¶åæ‰§è¡Œ, GCDä¼šè‡ªåŠ¨å°†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æŒ‰å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼å–å‡º. é˜Ÿåˆ—ä¸»è¦æœ‰çš„æœ‰<code>ä¸²è¡Œé˜Ÿåˆ—(Serial Dispatch Queue)</code>, <code>å¹¶è¡Œé˜Ÿåˆ—(Concurrent Dispatch Queue)</code>, <code>å…¨å±€é˜Ÿåˆ—(Global Queue)</code>å’Œ<code>ä¸»é˜Ÿåˆ—(Main Queue)</code>.</p>
<ul>
<li><p>ä¸²è¡Œé˜Ÿåˆ—: ä»»åŠ¡ä¾æ¬¡æ‰§è¡Œ, åŒä¸€æ—¶é—´é˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œ, æ¯ä¸ªä»»åŠ¡åªæœ‰åœ¨å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆåæ‰èƒ½å¼€å§‹æ‰§è¡Œ. ä½ ä¸çŸ¥é“åœ¨ä¸€ä¸ªBlock(ä»»åŠ¡)æ‰§è¡Œç»“æŸåˆ°ä¸‹ä¸€ä¸ªBlock(ä»»åŠ¡)å¼€å§‹æ‰§è¡Œä¹‹é—´çš„è¿™æ®µæ—¶é—´æ—¶é—´æ˜¯å¤šé•¿, è¿™éƒ¨åˆ†æ˜¯ç”±GCDæ§åˆ¶. åˆ›å»ºæ–¹å¼ä¸º:</p>
  <figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//åˆ›å»ºä¸€ä¸ªåä¸ºqueueçš„ä¸²è¡Œé˜Ÿåˆ—</div><div class="line">//ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—åç§°</div><div class="line">//ç¬¬äºŒä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—ç±»å‹, DISPATCH_QUEUE_SERIALå’ŒNULLè¡¨ç¤ºä¸²è¡Œé˜Ÿåˆ—</div><div class="line">dispatch_queue_t queue = dispatch_queue_create(&quot;com.private.SerialQueue&quot;, DISPATCH_QUEUE_SERIAL);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<pre><code>* å¹¶è¡Œé˜Ÿåˆ—: ä»»åŠ¡å¹¶å‘æ‰§è¡Œ, å”¯ä¸€èƒ½ä¿è¯çš„æ˜¯, è¿™äº›ä»»åŠ¡ä¼šæŒ‰ç…§è¢«æ·»åŠ çš„é¡ºåºå¼€å§‹æ‰§è¡Œ. ä½†æ˜¯ä»»åŠ¡å¯ä»¥ä»¥ä»»ä½•é¡ºåºå®Œæˆ, ä½ ä¸çŸ¥é“åœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹, æˆ–è€…è¯´ä»»æ„æ—¶åˆ»æœ‰å¤šä¸ªBlock(ä»»åŠ¡)è¿è¡Œ, è¿™ä¸ªå®Œå…¨æ˜¯å–å†³äºGCD. GCDé»˜è®¤å·²ç»æä¾›äº†å…¨å±€çš„å¹¶å‘é˜Ÿåˆ—, ä¾›æ•´ä¸ªåº”ç”¨ä½¿ç”¨, ä¸€èˆ¬ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºåˆ›å»ºæ–¹å¼ä¸º:

    <figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//åˆ›å»ºä¸€ä¸ªåä¸ºqueueçš„å¹¶è¡Œé˜Ÿåˆ—</div><div class="line">//ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—åç§°</div><div class="line">//ç¬¬äºŒä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—ç±»å‹, DISPATCH_QUEUE_CONCURRENTè¡¨ç¤ºå¹¶è¡Œé˜Ÿåˆ—</div><div class="line">dispatch_queue_t queue = dispatch_queue_create(&quot;com.private.ConcurrentQueue&quot;,DISPATCH_QUEUE_CONCURRENT);</div></pre></td></tr></table></figure>


* å…¨å±€é˜Ÿåˆ—: **éš¶å±äºå¹¶è¡Œé˜Ÿåˆ—**, ä¸è¦ä¸ barrier æ …æ æ–¹æ³•æ­é…ä½¿ç”¨, barrier åªæœ‰ä¸è‡ªå®šä¹‰çš„å¹¶è¡Œé˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨, æ‰èƒ½è®© barrier è¾¾åˆ°æˆ‘ä»¬æ‰€æœŸæœ›çš„æ …æ åŠŸèƒ½. ä¸ä¸²è¡Œé˜Ÿåˆ—æˆ–è€…globalé˜Ÿåˆ— ä¸€èµ·ä½¿ç”¨, barrierçš„è¡¨ç°ä¼šå’Œdispatch_syncæ–¹æ³•ä¸€æ ·. åˆ›å»ºæ–¹å¼ä¸º:

    <figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//è·å–ç³»ç»Ÿå…¨å±€é˜Ÿåˆ—, å¹¶èµ‹å€¼ç»™é˜Ÿåˆ—queue</div><div class="line">//ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºä¼˜å…ˆçº§, è¿™é‡Œæ˜¯æ–°è€ä¼˜å…ˆçº§çš„å¯¹ç…§Map</div><div class="line">*  - DISPATCH_QUEUE_PRIORITY_HIGH:         QOS_CLASS_USER_INITIATED//é«˜</div><div class="line">*  - DISPATCH_QUEUE_PRIORITY_DEFAULT:      QOS_CLASS_DEFAULT//é»˜è®¤</div><div class="line">*  - DISPATCH_QUEUE_PRIORITY_LOW:          QOS_CLASS_UTILITY//ä½</div><div class="line">*  - DISPATCH_QUEUE_PRIORITY_BACKGROUND:   QOS_CLASS_BACKGROUND//åå°</div><div class="line">    </div><div class="line">//ç¬¬äºŒä¸ªå‚æ•°æ˜¯é¢„ç•™å‚æ•°, ä¼ 0å°±å¥½</div><div class="line">dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div></pre></td></tr></table></figure>

* ä¸»é˜Ÿåˆ—: **éš¶å±äºä¸²è¡Œé˜Ÿåˆ—**, ä¸èƒ½ä¸syncåŒæ­¥æ–¹æ³•æ­é…ä½¿ç”¨, ä¼šé€ æˆæ­»å¾ªç¯. ä¸»é˜Ÿåˆ—æ˜¯GCDè‡ªå¸¦çš„ä¸€ç§ç‰¹æ®Šçš„ä¸²è¡Œé˜Ÿåˆ—, æ”¾åœ¨ä¸»é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡, éƒ½ä¼šæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ. åˆ›å»ºæ–¹å¼ä¸º:

    <figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//è·å–ç³»ç»Ÿä¸»é˜Ÿåˆ—, å¹¶èµ‹å€¼ç»™é˜Ÿåˆ—queue</div><div class="line">  dispatch_queue_t queue = dispatch_get_main_queue();</div></pre></td></tr></table></figure>
</code></pre><p>ä¸ç®¡æ˜¯ä¸²è¡Œé˜Ÿåˆ—(SerialQueue)è¿˜æ˜¯å¹¶è¡Œé˜Ÿåˆ—(ConcurrencyQueue), éƒ½æ˜¯FIFOé˜Ÿåˆ—. ä¹Ÿå°±æ„å‘³ç€, ä»»åŠ¡ä¸€å®šæ˜¯ä¸€ä¸ªä¸€ä¸ªåœ°, æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ¥æ‰§è¡Œ.</p>
<h3 id="NSOperation-amp-NSOperationQueue"><a href="#NSOperation-amp-NSOperationQueue" class="headerlink" title="NSOperation &amp; NSOperationQueue"></a>NSOperation &amp; NSOperationQueue</h3><p><code>NSOperation</code> æ˜¯è‹¹æœå…¬å¸å¯¹<code>GCD</code>çš„å°è£…, å®Œå…¨é¢å‘å¯¹è±¡, æ‰€ä»¥ä½¿ç”¨èµ·æ¥æ›´å¥½ç†è§£. å¤§å®¶å¯ä»¥çœ‹åˆ° <code>NSOperation</code>å’Œ<code>NSOperationQueue</code>åˆ†åˆ«å¯¹åº”<code>GCD</code>çš„<strong>ä»»åŠ¡</strong>å’Œ<strong>é˜Ÿåˆ—</strong>. æ‰€ä»¥ä»–çš„æ“ä½œæ­¥éª¤å’Œ<code>GCD</code>ç±»ä¼¼: é¦–å…ˆå°†è¦æ‰§è¡Œçš„ä»»åŠ¡å°è£…åˆ°ä¸€ä¸ª<code>NSOperation</code>å¯¹è±¡ä¸­. ç„¶åå°†æ­¤ä»»åŠ¡æ·»åŠ åˆ°ä¸€ä¸ª<code>NSOperationQueue</code>å¯¹è±¡ä¸­, ç„¶åç³»ç»Ÿå°±ä¼šè‡ªåŠ¨åœ¨æ‰§è¡Œä»»åŠ¡.</p>
<h4 id="NSOperation"><a href="#NSOperation" class="headerlink" title="NSOperation"></a>NSOperation</h4><p>NSOperationä¸»è¦æœ‰ä¸€ä¸‹è¿™äº›å±æ€§å’Œæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@interface NSOperation : NSObject &#123;</div><div class="line">@private</div><div class="line"> id _private;</div><div class="line"> int32_t _private1;</div><div class="line">#if __LP64__</div><div class="line"> int32_t _private1b;</div><div class="line">#endif</div><div class="line">&#125;</div><div class="line">  </div><div class="line">- (void)start;//å¯åŠ¨ä»»åŠ¡ é»˜è®¤åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ</div><div class="line">- (void)main;//è‡ªå®šä¹‰NSOperationï¼Œå†™ä¸€ä¸ªå­ç±»ï¼Œé‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢æ·»åŠ éœ€è¦æ‰§è¡Œçš„æ“ä½œã€‚</div><div class="line">  </div><div class="line">@property (readonly, getter=isCancelled) BOOL cancelled;//æ˜¯å¦å·²ç»å–æ¶ˆï¼Œåªè¯»</div><div class="line">- (void)cancel;//å–æ¶ˆä»»åŠ¡</div><div class="line">  </div><div class="line">@property (readonly, getter=isExecuting) BOOL executing;//æ­£åœ¨æ‰§è¡Œï¼Œåªè¯»</div><div class="line">@property (readonly, getter=isFinished) BOOL finished;//æ‰§è¡Œç»“æŸï¼Œåªè¯»</div><div class="line">@property (readonly, getter=isConcurrent) BOOL concurrent; // To be deprecated; use and override &apos;asynchronous&apos; below</div><div class="line">@property (readonly, getter=isAsynchronous) BOOL asynchronous NS_AVAILABLE(10_8, 7_0);//æ˜¯å¦å¹¶å‘ï¼Œåªè¯»</div><div class="line">@property (readonly, getter=isReady) BOOL ready;//å‡†å¤‡æ‰§è¡Œ</div><div class="line">  </div><div class="line">- (void)addDependency:(NSOperation *)op;//æ·»åŠ ä¾èµ–</div><div class="line">- (void)removeDependency:(NSOperation *)op;//ç§»é™¤ä¾èµ–</div><div class="line">  </div><div class="line">@property (readonly, copy) NSArray&lt;NSOperation *&gt; *dependencies;//æ‰€æœ‰ä¾èµ–å…³ç³»ï¼Œåªè¯»</div><div class="line">  </div><div class="line">typedef NS_ENUM(NSInteger, NSOperationQueuePriority) &#123;</div><div class="line"> NSOperationQueuePriorityVeryLow = -8L,</div><div class="line"> NSOperationQueuePriorityLow = -4L,</div><div class="line"> NSOperationQueuePriorityNormal = 0,</div><div class="line"> NSOperationQueuePriorityHigh = 4,</div><div class="line"> NSOperationQueuePriorityVeryHigh = 8</div><div class="line">&#125;;//ç³»ç»Ÿæä¾›çš„ä¼˜å…ˆçº§å…³ç³»æšä¸¾</div><div class="line">  </div><div class="line">@property NSOperationQueuePriority queuePriority;//æ‰§è¡Œä¼˜å…ˆçº§</div><div class="line">  </div><div class="line">@property (nullable, copy) void (^completionBlock)(void) NS_AVAILABLE(10_6, 4_0);//ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åçš„å›è°ƒ</div><div class="line">  </div><div class="line">- (void)waitUntilFinished NS_AVAILABLE(10_6, 4_0);//é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰åˆ°æŸä¸ªoperationæ‰§è¡Œå®Œæ¯•ã€‚</div><div class="line">  </div><div class="line">@property double threadPriority NS_DEPRECATED(10_6, 10_10, 4_0, 8_0);//å·²åºŸå¼ƒï¼Œç”¨qualityOfServiceæ›¿ä»£ã€‚</div><div class="line">  </div><div class="line">@property NSQualityOfService qualityOfService NS_AVAILABLE(10_10, 8_0);//æœåŠ¡è´¨é‡ï¼Œä¸€ä¸ªé«˜è´¨é‡çš„æœåŠ¡å°±æ„å‘³ç€æ›´å¤šçš„èµ„æºå¾—ä»¥æä¾›æ¥æ›´å¿«çš„å®Œæˆæ“ä½œã€‚</div><div class="line">  </div><div class="line">@property (nullable, copy) NSString *name NS_AVAILABLE(10_10, 8_0);//ä»»åŠ¡åç§°</div><div class="line">   </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ç”±äº<code>NSOperation</code>æ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±», ä¸èƒ½ç›´æ¥ä½¿ç”¨, åœ¨è¿™é‡Œæˆ‘ä¹ˆä½ ä¸€èˆ¬ä½¿ç”¨<code>NSOperation</code>çš„ä¸¤ä¸ªå­ç±»<code>NSInvocationOperation</code>å’Œ<code>NSBlockOperation</code>, æˆ–è€…<code>NSOperationçš„è‡ªå®šä¹‰å­ç±»</code>:</p>
<ul>
<li><p><code>NSInvocationOperation</code>åŸºäºåº”ç”¨çš„ä¸€ä¸ªtargetå¯¹è±¡å’Œselectoræ¥åˆ›å»ºoperation object. å¦‚æœä½ å·²ç»æœ‰ç°æœ‰çš„æ–¹æ³•æ¥æ‰§è¡Œéœ€è¦çš„ä»»åŠ¡, å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç±». ä½¿ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹: </p>
  <figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)NSInvocationOperationRun &#123;</div><div class="line">  NSInvocationOperation *invocationOper = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(invocationOperSel) object:nil];</div><div class="line">  [invocationOper start];</div><div class="line">&#125;</div><div class="line">- (void)invocationOperSel &#123;</div><div class="line">  NSLog(@&quot;NSInvocationOperationRun_%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡º, è¯¥å®ç°æ–¹å¼æ˜¯åŒæ­¥é¡ºåºæ‰§è¡Œ.</p>
</li>
<li><p><code>NSBlockOperation</code>ç”¨æ¥å¹¶å‘åœ°æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªblockå¯¹è±¡. operation objectä½¿ç”¨<strong>ç»„</strong>çš„è¯­ä¹‰æ¥æ‰§è¡Œå¤šä¸ªblockå¯¹è±¡ï¼Œæ‰€æœ‰ç›¸å…³çš„ block éƒ½æ‰§è¡Œå®Œæˆä¹‹å, operation objectæ‰ç®—å®Œæˆ. ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:</p>
  <figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//ç³»ç»Ÿæä¾›çš„API</div><div class="line">@interface NSBlockOperation : NSOperation &#123;</div><div class="line">@private</div><div class="line">id _private2;</div><div class="line">void *_reserved2;</div><div class="line">&#125;</div><div class="line">  </div><div class="line">+ (instancetype)blockOperationWithBlock:(void (^)(void))block;//åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ</div><div class="line">  </div><div class="line">- (void)addExecutionBlock:(void (^)(void))block;//æ–°å¼€çº¿ç¨‹æ‰§è¡Œ</div><div class="line">@property (readonly, copy) NSArray&lt;void (^)(void)&gt; *executionBlocks;</div><div class="line">  </div><div class="line">@end</div></pre></td></tr></table></figure>
<p> ä½¿ç”¨<code>NSBlockOperation</code>ç±»æ–¹æ³•åˆ›å»ºä»»åŠ¡, ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºæ¥è¯¥ä»»åŠ¡æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„</p>
  <figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)NSBlockOperationRun &#123;</div><div class="line">NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^&#123;</div><div class="line">   NSLog(@&quot;NSBlockOperationRun_%@_%@&quot;, [NSOperationQueue currentQueue], [NSThread currentThread]);</div><div class="line">&#125;];</div><div class="line">[blockOper start];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> ä½¿ç”¨<code>NBlockOperation</code>çš„å®ä¾‹æ–¹æ³•åˆ›å»ºä»»åŠ¡, ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºæ¥, ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ, å…¶ä»–ä»»åŠ¡å‡æ˜¯æ–°å¼€çš„çº¿ç¨‹, æ‰€æœ‰çš„ä»»åŠ¡æ˜¯ä»¥å¼‚æ­¥å¹¶å‘çš„å½¢å¼æ‰§è¡Œ. </p>
  <figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)NSBlockOperationRun &#123;</div><div class="line">NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^&#123;</div><div class="line">    NSLog(@&quot;NSBlockOperationRun_1_%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;];</div><div class="line">[blockOper addExecutionBlock:^&#123;</div><div class="line">    NSLog(@&quot;NSBlockOperationRun_2_%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;];</div><div class="line">[blockOper addExecutionBlock:^&#123;</div><div class="line">    NSLog(@&quot;NSBlockOperationRun_3_%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;];</div><div class="line">[blockOper addExecutionBlock:^&#123;</div><div class="line">    NSLog(@&quot;NSBlockOperationRun_4_%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;];</div><div class="line">[blockOper start];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>NSOperationçš„è‡ªå®šä¹‰å­ç±». åœ¨å­ç±»ä¸­é‡å†™çˆ¶ç±»çš„<code>-(void)main</code>å‡½æ•°, åœ¨é‡Œé¢å®ç°ä¸»è¦é€»è¾‘. <code>NSBlockOperation</code>, <code>NSBlockOperationRun</code>æˆ–è€…<code>NSOperationçš„è‡ªå®šä¹‰å­ç±»</code>åˆ›å»ºçš„operation objectéƒ½å¯ä»¥ä½¿ç”¨<code>NSOperation</code>çš„æ‰€æœ‰å±æ€§, æ„å‘³ç€ä»–ä»¬å…·æœ‰ä»¥ä¸‹ä¸»è¦ç‰¹æ€§: </p>
<ul>
<li>å¤šä¸ªä»»åŠ¡ä¹‹é—´å¯ä»¥ä½¿ç”¨æœ‰ä¾èµ–å…³ç³»</li>
<li>å¯ä»¥è·å¾—Operation objectä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åçš„å›è°ƒ</li>
<li>æ”¯æŒåº”ç”¨ä½¿ç”¨ KVO é€šçŸ¥æ¥ç›‘æ§ operation çš„æ‰§è¡ŒçŠ¶æ€</li>
<li>å¯ä»¥é€šè¿‡operationä¼˜å…ˆçº§, ä»è€Œå½±å“ç›¸å¯¹çš„æ‰§è¡Œé¡ºåº</li>
<li>å¯ä»¥ç»ˆæ­¢æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡</li>
</ul>
</li>
</ul>
<h4 id="NSOperationQueue"><a href="#NSOperationQueue" class="headerlink" title="NSOperationQueue"></a>NSOperationQueue</h4><p><code>NSOperationQueue</code>ç±»ä¼¼äºGCDä¸­çš„é˜Ÿåˆ—, åªéœ€è¦å§ä»»åŠ¡åŠ å…¥åˆ°<code>NSOperationQueue</code>ä¸­, å°±ä¼šè‡ªåŠ¨è¿è¡Œ, ç”±ç³»ç»Ÿé€šè¿‡æœ€å¤§å¹¶å‘æ•°æ¥æ§åˆ¶æ˜¯å¹¶è¡Œè¿˜æ˜¯ä¸²è¡Œ, å®˜æ–¹æä¾›çš„APIå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">static const NSInteger NSOperationQueueDefaultMaxConcurrentOperationCount = -1;</div><div class="line">    </div><div class="line">NS_CLASS_AVAILABLE(10_5, 2_0)</div><div class="line">@interface NSOperationQueue : NSObject &#123;</div><div class="line">@private</div><div class="line">   id _private;</div><div class="line">   void *_reserved;</div><div class="line">&#125;</div><div class="line">    </div><div class="line">- (void)addOperation:(NSOperation *)op;//å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡</div><div class="line">- (void)addOperations:(NSArray&lt;NSOperation *&gt; *)ops waitUntilFinished:(BOOL)wait API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//æ·»åŠ ä¸€ç»„ä»»åŠ¡</div><div class="line">    </div><div class="line">- (void)addOperationWithBlock:(void (^)(void))block API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//æ·»åŠ ä¸€ä¸ªblockå½¢å¼çš„ä»»åŠ¡</div><div class="line">    </div><div class="line">@property (readonly, copy) NSArray&lt;__kindof NSOperation *&gt; *operations;//é˜Ÿåˆ—ä¸­æ‰€æœ‰ä»»åŠ¡çš„æ•°ç»„</div><div class="line">@property (readonly) NSUInteger operationCount API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//é˜Ÿåˆ—ä¸­æ‰€æœ‰ä»»åŠ¡æ•°</div><div class="line">    </div><div class="line">@property NSInteger maxConcurrentOperationCount;//æœ€å¤§å¹¶å‘æ•°</div><div class="line">    </div><div class="line">@property (getter=isSuspended) BOOL suspended;//æš‚åœ</div><div class="line">    </div><div class="line">@property (nullable, copy) NSString *name API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//åç§°</div><div class="line">    </div><div class="line">@property NSQualityOfService qualityOfService API_AVAILABLE(macos(10.10), ios(8.0), watchos(2.0), tvos(9.0));//æœåŠ¡è´¨é‡, ç³»ç»Ÿä¼šä¸ºæƒé‡é«˜çš„æœåŠ¡åˆ†é…æ›´å¤šçš„èµ„æº</div><div class="line">    </div><div class="line">@property (nullable, assign /* actually retain */) dispatch_queue_t underlyingQueue API_AVAILABLE(macos(10.10), ios(8.0), watchos(2.0), tvos(9.0));</div><div class="line">    </div><div class="line">- (void)cancelAllOperations;//å–æ¶ˆé˜Ÿåˆ—ä¸­æ‰€æœ‰çš„ä»»åŠ¡</div><div class="line">    </div><div class="line">- (void)waitUntilAllOperationsAreFinished;//é˜»å¡å½“å‰çº¿ç¨‹, ç­‰åˆ°é˜Ÿåˆ—ä¸­çš„å…¨éƒ¨ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•</div><div class="line">    </div><div class="line">@property (class, readonly, strong, nullable) NSOperationQueue *currentQueue API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//è·å–å½“å‰é˜Ÿåˆ—</div><div class="line">@property (class, readonly, strong) NSOperationQueue *mainQueue API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//è·å–ä¸»é˜Ÿåˆ—</div><div class="line">    </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//ä»¥ä¸‰ç§æ–¹å¼ä¸ºé˜Ÿåˆ—æ·»åŠ äº†ä¸‰ä¸ªä»»åŠ¡, </div><div class="line">- (void)NSOperationQueueRun &#123;</div><div class="line">   NSOperationQueue *queue = [[NSOperationQueue alloc] init];</div><div class="line">   NSInvocationOperation *invocationOper = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(invocationOperSel) object:nil];</div><div class="line">   [queue addOperation:invocationOper];</div><div class="line">   NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^&#123;</div><div class="line">       NSLog(@&quot;NSBlockOperationRun_%@&quot;, [NSThread currentThread]);</div><div class="line">   &#125;];</div><div class="line">   [queue addOperation:blockOper];</div><div class="line">   [queue addOperationWithBlock:^&#123;</div><div class="line">       NSLog(@&quot;QUEUEBlockOperationRun_%@&quot;, [NSThread currentThread]);</div><div class="line">   &#125;];</div><div class="line">&#125;</div><div class="line">    </div><div class="line">- (void)invocationOperSel &#123;</div><div class="line">   NSLog(@&quot;NSInvocationOperationRun_%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸€èˆ¬æƒ…å†µä¸‹, <code>NSOperationQueue</code>ä¼šæŒ‰ç…§ä»»åŠ¡æ·»åŠ çš„é¡ºåºæ¥æ‰§è¡Œä»»åŠ¡, ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ä¼˜å…ˆçº§å’Œä¾èµ–å…³ç³»æ¥æ”¹å˜æ‰§è¡Œé¡ºåº. å¹¶å‘æ•°å¤§äºä»»åŠ¡æ•°, æ²¡æœ‰è®¾ç½®ä¾èµ–å…³ç³», å¹¶ä¸”åœ¨åŒä¸€é˜Ÿåˆ—.</p>
<h2 id="å¸¸è§çš„ä½¿ç”¨æ–¹å¼"><a href="#å¸¸è§çš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="å¸¸è§çš„ä½¿ç”¨æ–¹å¼"></a>å¸¸è§çš„ä½¿ç”¨æ–¹å¼</h2><h3 id="GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><a href="#GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"></a>GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</h3><p>è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥è·å–ç³»ç»Ÿæä¾›çš„å…¨å±€å¹¶è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡. ä»»åŠ¡ä¼šéµå®ˆFIFOåŸåˆ™æ¥æ‰§è¡Œ, ä½†æ˜¯æ¯ä¸ªä»»åŠ¡ä½•æ—¶æ‰§è¡Œå®Œæˆ‘ä»¬å´å¹¶ä¸çŸ¥é“. ä½†æ˜¯ç³»ç»Ÿä¼šæ–°å¼€çº¿ç¨‹æ¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡, ä¸‰ä¸ªå¼‚æ­¥ä»»åŠ¡ä¼šåˆ†åˆ«åœ¨ä¸‰ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ, å„ä¸ªä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæ— æ³•ç¡®å®š.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)test1 &#123;</div><div class="line">    //è·å–ç³»ç»Ÿæä¾›çš„å…¨å±€é˜Ÿåˆ—</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    </div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]);</div><div class="line">        sleep(5);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><a href="#GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡"></a>GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</h3><p>è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡. ä»»åŠ¡ä¼šéµå®ˆFIFOåŸåˆ™æ¥æ‰§è¡Œ, æ¯ä¸ªä»»åŠ¡ä½•æ—¶æ‰§è¡Œå®Œæˆ‘ä»¬å´å¹¶ä¸çŸ¥é“. ä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯åœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ çš„ä»»åŠ¡, ä¸ä¼šæ–°å¼€çº¿ç¨‹, æ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡ä¼šæŒ‰ç…§é¡ºåºå‰ä¸€ä¸ªæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œåä¸€ä¸ª.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"> - (void)test2 &#123;</div><div class="line">    //åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—, ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸²è¡Œé˜Ÿåˆ—çš„åç§°, ç¬¬äºŒä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—çš„å±æ€§, NULLæˆ–è€…DISPATCH_QUEUE_SERIALè¡¨ç¤ºæ˜¯ä¸²è¡Œé˜Ÿåˆ—</div><div class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;test2&quot;, NULL);</div><div class="line">    </div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]);</div><div class="line">        sleep(5);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡"><a href="#GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡" class="headerlink" title="GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡"></a>GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡</h3><p>è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥è·å–ç³»ç»Ÿæä¾›çš„å…¨å±€å¹¶è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ åŒæ­¥ä»»åŠ¡. ä»»åŠ¡ä¼šéµå®ˆFIFOåŸåˆ™æ¥æ‰§è¡Œ, æ¯ä¸ªä»»åŠ¡ä½•æ—¶æ‰§è¡Œå®Œæˆ‘ä»¬å´å¹¶ä¸çŸ¥é“. è™½ç„¶æ˜¯å¹¶è¡Œé˜Ÿåˆ—, å•ç”±äºæ·»åŠ çš„æ˜¯åŒæ­¥ä»»åŠ¡, ä¸ä¼šæ–°å¼€çº¿ç¨‹, å…¨éƒ½åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œ, æ‰€ä»¥ä¸‰ä¸ªä»»åŠ¡ä¼šé¡ºåºæ‰§è¡Œ, å¹¶è¡Œé˜Ÿåˆ—å¤±å»äº†å¹¶è¡Œçš„èƒ½åŠ›. </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ åŒæ­¥ä»»åŠ¡</div><div class="line">- (void)test3 &#123;</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    </div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_sync(queue, ^&#123;</div><div class="line">        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]);</div><div class="line">        sleep(5);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_sync(queue, ^&#123;</div><div class="line">        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_sync(queue, ^&#123;</div><div class="line">        NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GCD-å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡"><a href="#GCD-å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="GCD å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡"></a>GCD å‘ä¸²è¡Œé˜Ÿåˆ—æ·»åŠ å¼‚æ­¥ä»»åŠ¡</h3><p>è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥åˆ›å»ºè‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡. è™½ç„¶å¼‚æ­¥ä»»åŠ¡ä¼šæ–°å¼€çº¿ç¨‹, ä½†æ˜¯ç”±äºæ˜¯åœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­æ‰§è¡Œ, æ‰€ä»¥ä¸æ–°å¼€çº¿ç¨‹, æ‰€æœ‰ä»»åŠ¡å‰ä¸€ä¸ªæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œä¸‹ä¸€ä¸ª.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)test4 &#123;</div><div class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;test4&quot;, NULL);</div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">       NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]);</div><div class="line">       sleep(5);</div><div class="line">    &#125;);</div><div class="line">        </div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">       NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">        </div><div class="line">    //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">       NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Dispatch-Group"><a href="#Dispatch-Group" class="headerlink" title="Dispatch Group"></a>Dispatch Group</h3><p>åˆ†ç»„æ¨¡å¼ <code>dispatch_group_notify</code>. å¯ä»¥å¼‚æ­¥æ‰§è¡Œå¤šä¸ªè€—æ—¶æ“ä½œ. ç­‰è€—æ—¶æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šå›åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œ, ä¸»è¦ç”¨äºç›‘å¬ä»»åŠ¡æ˜¯å¦å®Œæˆ. ä¸»è¦æœ‰ä¸¤ç§ç”¨æ³•: </p>
<p>ç¬¬ä¸€ç§ç”¨æ³•æ˜¯é€šè¿‡<code>dispatch_group_async</code>, é¦–å…ˆåˆ›å»ºä¸€ä¸ªå…¨å±€å¹¶è¡Œé˜Ÿåˆ—å’Œä¸€ä¸ªgroupé˜Ÿåˆ—ç»„, å†æ¬¡åˆ›å»ºå¼‚æ­¥groupä»»åŠ¡åŠ å…¥åˆ°å‰é¢åˆ›å»ºçš„groupé˜Ÿåˆ—ä¸­å». å½“æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡å®Œæˆå, ä¼šé€šè¿‡<code>dispatch_group_notify</code>å›åˆ°ä¸»çº¿ç¨‹.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)groupTest1 &#123;</div><div class="line">    //è·å–å…¨å±€é˜Ÿåˆ—</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    //åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ç»„</div><div class="line">    dispatch_group_t group = dispatch_group_create();</div><div class="line">    </div><div class="line">    dispatch_group_async(group, queue, ^&#123;</div><div class="line">        NSLog(@&quot;--- 1 å¼€å§‹--- %@&quot;, [NSThread currentThread]);</div><div class="line">        //å»¶æ—¶5ç§’ æ¨¡ä»¿å µå¡å­çº¿ç¨‹</div><div class="line">        [NSThread sleepForTimeInterval:5];</div><div class="line">        NSLog(@&quot;--- 1 --- å®Œæˆ %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_group_async(group, queue, ^&#123;</div><div class="line">        NSLog(@&quot;--- 2 å¼€å§‹--- %@&quot;, [NSThread currentThread]);</div><div class="line">        //å»¶æ—¶5ç§’ æ¨¡ä»¿å µå¡å­çº¿ç¨‹</div><div class="line">        [NSThread sleepForTimeInterval:5];</div><div class="line">        NSLog(@&quot;--- 2 --- å®Œæˆ %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //åœ¨è¿™ä¸ªé˜Ÿåˆ—ç»„é‡Œé¢ï¼Œä¼šç­‰groupä¸­çš„å…¨éƒ¨ä»£ç æ‰§è¡Œå®Œæ¯•å†å»æ‰§è¡Œå…¶å®ƒçš„æ“ä½œ</div><div class="line">    dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</div><div class="line">        // ç­‰å‰é¢çš„å¼‚æ­¥æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•åï¼Œå›åˆ°ä¸»çº¿ç¨‹...</div><div class="line">        NSLog(@&quot;å…¨éƒ¨å®Œæˆ&quot;);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§ç”¨æ³•æ˜¯é€šè¿‡ä¿¡å·é‡<code>dispatch_group_enter</code> å’Œ <code>dispatch_group_leave</code>. åˆ›å»ºä¸€ä¸ªå¹¶è¡Œçº¿ç¨‹å’Œå¤šä¸ªå¼‚æ­¥ä»»åŠ¡, å°†å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°å¹¶è¡Œçº¿ç¨‹ä¸­åŒº. é€šè¿‡<code>dispatch_group_enter</code>æ¥å‘ŠçŸ¥<code>group</code>ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å¼€å§‹,  æœªæ‰§è¡Œå®Œæ¯•ä»»åŠ¡æ•°åŠ 1. åœ¨å¼‚æ­¥çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶, é€šè¿‡<code>dispatch_group_leave</code>å‘ŠçŸ¥group, ä¸€ä¸ªä»»åŠ¡ç»“æŸ, æœªæ‰§è¡Œå®Œæ¯•ä»»åŠ¡æ•°å‡1. å½“æœªæ‰§è¡Œå®Œæ¯•ä»»åŠ¡æ•°ä¸º0çš„æ—¶å€™, è¿™æ—¶groupæ‰è®¤ä¸ºç»„å†…ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•äº†(è¿™ä¸ªå’ŒGCDçš„ä¿¡å·é‡çš„æœºåˆ¶æœ‰äº›ç›¸ä¼¼), è¿™æ—¶å€™æ‰ä¼šå›è°ƒ<code>dispatch_group_notify</code>ä¸­çš„block. æ­¤å¤„éœ€è¦æ³¨æ„, <code>dispatch_group_enter</code>å’Œ<code>dispatch_group_leave</code>çš„æ•°é‡ä¸€å®šè¦ä¸€è‡´. </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)groupTest2 &#123;</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    dispatch_group_t group = dispatch_group_create();</div><div class="line">    </div><div class="line">    dispatch_group_enter(group);</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        sleep(2); //è¿™é‡Œçº¿ç¨‹ç¡çœ 1ç§’é’Ÿï¼Œæ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚</div><div class="line">        NSLog(@&quot;%@ one finish&quot;, [NSThread currentThread]);</div><div class="line">        dispatch_group_leave(group);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_group_enter(group);</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        sleep(2); //è¿™é‡Œçº¿ç¨‹ç¡çœ 1ç§’é’Ÿï¼Œæ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚</div><div class="line">        NSLog(@&quot;%@ two finish&quot;, [NSThread currentThread]);</div><div class="line">        dispatch_group_leave(group);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_group_notify(group, queue, ^&#123;</div><div class="line">        NSLog(@&quot;group finished&quot;);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GCDå»¶æ—¶æ“ä½œ-dispatch-after"><a href="#GCDå»¶æ—¶æ“ä½œ-dispatch-after" class="headerlink" title="GCDå»¶æ—¶æ“ä½œ(dispatch_after)"></a>GCDå»¶æ—¶æ“ä½œ(dispatch_after)</h3><p>ä½¿ç”¨å¾ˆç®€å•, ä¸¤ä¸ªæ ¸å¿ƒçš„å¯¹è±¡<code>dispatch_time_t</code>å’Œ<code>dispatch_after</code>. å¤§å®¶éƒ½ç»å¸¸ä½¿ç”¨, ä¸ç”¨å¤šè¯´. ä¸‹é¢çš„ä»£ç å’Œåœ¨3å¦™æ‰‹ç”¨<code>dispatch_async</code>å‡½æ•°è¿½åŠ blockåˆ°ä¸»çº¿ç¨‹çš„æ“ä½œæ˜¯ç›¸åŒçš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)afterTest &#123;</div><div class="line">    double delayInSeconds = 2.0;</div><div class="line">    dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t) (delayInSeconds * NSEC_PER_SEC));</div><div class="line">    //ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨æ—¶é—´, ç¬¬äºŒå„å‚æ•°ä»£è¡¨è¦åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œæ¥ä¸‹æ¥çš„ä»»åŠ¡, ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯ä»»åŠ¡block</div><div class="line">    dispatch_after(popTime, dispatch_get_main_queue(), ^(void)&#123;</div><div class="line">        NSLog(@&quot;%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GCDå•ä¾‹-dispatch-once"><a href="#GCDå•ä¾‹-dispatch-once" class="headerlink" title="GCDå•ä¾‹(dispatch_once)"></a>GCDå•ä¾‹(dispatch_once)</h3><p>è¿™ä¸ªæ›´æ˜¯ä¸ç”¨å¤šè¯´, ç›´æ¥è´´ä¸Šä»£ç .</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@interface Tool : NSObject</div><div class="line">+ (instancetype)sharedTool;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation Tool</div><div class="line">static id _instance;</div><div class="line">+ (instancetype)sharedTool &#123;</div><div class="line">    static dispatch_once_t onceToken;</div><div class="line">    dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">        _instance = [[Tool alloc] init];</div><div class="line">    &#125;);</div><div class="line">    return _instance;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h3 id="GCD-çº¿ç¨‹é—´çš„é€šè®¯"><a href="#GCD-çº¿ç¨‹é—´çš„é€šè®¯" class="headerlink" title="GCD çº¿ç¨‹é—´çš„é€šè®¯"></a>GCD çº¿ç¨‹é—´çš„é€šè®¯</h3><p>å¸¸ç”¨çš„æ–¹å¼å°±æ˜¯åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œé•¿æ—¶é—´ä»»åŠ¡, å¤„ç†ç»“æŸæ—¶, ä¸»çº¿ç¨‹ä½¿ç”¨è¯¥å¤„ç†ç»“æœ. ä»£ç å¦‚ä¸‹: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)threadTest &#123;</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        //åœ¨è¿™é‡Œæ‰§è¡Œè€—æ—¶çš„æ“ä½œ</div><div class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">            //åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨ä¸Šé¢æ“ä½œçš„ç»“æœ</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GCDé‡å¤æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡-dispatch-apply"><a href="#GCDé‡å¤æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡-dispatch-apply" class="headerlink" title="GCDé‡å¤æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡(dispatch_apply)"></a>GCDé‡å¤æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡(dispatch_apply)</h3><p><code>disaptch_apply</code>å‡½æ•°æ˜¯<code>dispatch_sync</code>å‡½æ•°å’Œ<code>Dispatch Group</code>çš„å…³è”API, è¯¥å‡½æ•°æŒ‰ç…§æŒ‡å®šçš„æ¬¡æ•°å°†æŒ‡å®šçš„Blockè¿½åŠ åˆ°æŒ‡å®šçš„Dispatch Queueä¸­, å¹¶ç­‰å¾…å¤„ç†æ‰§è¡Œç»“æŸ. </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)applyTest &#123;</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    dispatch_apply(10, queue, ^(size_t index) &#123;</div><div class="line">        //å¹¶è¡Œå¤„ç†10æ¬¡ä»»åŠ¡</div><div class="line">        NSLog(@&quot;%zu&quot;, index);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½†æ˜¯ç”±äº<code>dispatch_apply</code>å‡½æ•°ä¸<code>dispatch_sync</code>å‡½æ•°ç›¸åŒ, ä¼šç­‰å¾…ä»»åŠ¡æ‰§è¡Œç»“æŸ, æ‰€ä»¥æˆ‘ä»¬å¼ºçƒˆæ¨èåœ¨<code>dispatch_async</code>å‡½æ•°ä¸­å¼‚æ­¥æ‰§è¡Œ. </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)applyTest &#123;</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    </div><div class="line">    //åœ¨å…¨å±€å¹¶è¡Œé˜Ÿåˆ—ä¸­å¼‚æ­¥æ‰§è¡Œ</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        //ç­‰å¾…å‡½æ•°ä¸­æ“ä½œå…¨éƒ¨æ‰§è¡Œå®Œæ¯•</div><div class="line">        dispatch_apply(10, queue, ^(size_t index) &#123;</div><div class="line">            //å¹¶è¡Œå¤„ç†10æ¬¡ä»»åŠ¡</div><div class="line">            sleep(2);</div><div class="line">            NSLog(@&quot;%zu&quot;, index);</div><div class="line">        &#125;);</div><div class="line">        </div><div class="line">        //dispatch_applyä¸­çš„å¤„ç†å…¨éƒ¨ç»“æŸ, åœ¨ä¸»çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œ</div><div class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">            NSLog(@&quot;Done&quot;);</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GCDè®¾ç½®ä¼˜å…ˆçº§-dispatch-set-target-queue"><a href="#GCDè®¾ç½®ä¼˜å…ˆçº§-dispatch-set-target-queue" class="headerlink" title="GCDè®¾ç½®ä¼˜å…ˆçº§(dispatch_set_target_queue)"></a>GCDè®¾ç½®ä¼˜å…ˆçº§(dispatch_set_target_queue)</h3><p>å°†queueçš„ä¼˜å…ˆçº§é€šè¿‡<code>dispatch_set_target_queue</code>å˜æ›´çš„å’Œqueue1çš„ä¼˜å…ˆçº§ä¸€è‡´, ä»£ç å¦‚ä¸‹. </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)targetQueeuTest &#123;</div><div class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;test&quot;, NULL);</div><div class="line">    dispatch_queue_t queue1 = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    //æŠŠç¬¬ä¸€ä¸ªå‚æ•°çš„æ‰§è¡Œä¼˜å…ˆçº§è®¾ç½®çš„å’Œç¬¬äºŒä¸ªå‚æ•°çš„ä¼˜å…ˆçº§ä¸€è‡´.</div><div class="line">    dispatch_set_target_queue(queue, queue1);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GCDæ …æ -dispatch-barrier-async"><a href="#GCDæ …æ -dispatch-barrier-async" class="headerlink" title="GCDæ …æ (dispatch_barrier_async)"></a>GCDæ …æ (dispatch_barrier_async)</h3><p>ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹, å‡è®¾ä¸€ä¸ªå¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ äº†äº”ä¸ªå¼‚æ­¥ä»»åŠ¡, è™½ç„¶éµå¾ªFIFOçš„åŸåˆ™, è¿™äº”ä¸ªä»»åŠ¡çš„æ‰§è¡Œå¿…å®šæ˜¯æ— åºçš„. å½“æˆ‘ä»¬åœ¨ç¬¬ä¸‰ä¸ªä»»åŠ¡ä¹‹ååŠ å…¥<code>dispatch_barrier_async</code>ä»»åŠ¡, é‚£ä¹ˆè¿™äº”ä¸ªä»»åŠ¡å°±è¢«åˆ†å‰²æˆä¸¤éƒ¨åˆ†, å‰ä¸‰æ¬¡æ— åºæ‰§è¡Œ, ç„¶åæ‰§è¡Œ<code>dispatch_barrier_async</code>ä»»åŠ¡, ç„¶åå†æ— åºæ‰§è¡Œåä¸¤æ¬¡ä»»åŠ¡. æ³¨æ„<strong>æ­¤å¤„çš„é˜Ÿåˆ—åªèƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„å¹¶è¡Œé˜Ÿåˆ—, ç³»ç»Ÿæä¾›çš„å…¨å±€é˜Ÿåˆ—ä¸è¡Œ</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)barrierTest &#123;</div><div class="line">    </div><div class="line">    //æ­¤å¤„çš„é˜Ÿåˆ—åªèƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„å¹¶è¡Œé˜Ÿåˆ—, ç³»ç»Ÿæä¾›çš„å…¨å±€é˜Ÿåˆ—ä¸è¡Œ</div><div class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;barrierTest&quot;, DISPATCH_QUEUE_CONCURRENT);</div><div class="line">    </div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;1&quot;);</div><div class="line">    &#125;);</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;2&quot;);</div><div class="line">    &#125;);</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;3&quot;);</div><div class="line">    &#125;);</div><div class="line">    dispatch_barrier_async(queue, ^&#123;</div><div class="line">        sleep(3);</div><div class="line">        NSLog(@&quot;æ’å…¥æ‰§è¡Œ&quot;);</div><div class="line">    &#125;);</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;4&quot;);</div><div class="line">    &#125;);</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;5&quot;);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GCDä¿¡å·é‡-dispatch-semaphore-t"><a href="#GCDä¿¡å·é‡-dispatch-semaphore-t" class="headerlink" title="GCDä¿¡å·é‡(dispatch_semaphore_t)"></a>GCDä¿¡å·é‡(dispatch_semaphore_t)</h3><p>æˆ‘ä»¬ä»¥è¿™ä¸ªä½¿ç”¨åœºæ™¯ä¸ºä¾‹, æ¥è¯´æ˜ä¸€ä¸‹, ä¸è€ƒè™‘é¡ºåº å°†æ‰€æœ‰çš„æ•°æ®æ·»åŠ åˆ°ç©ºæ•°ç»„ä¸­å», æˆ‘ä»¬å¯èƒ½ä¼šè¿™ä¹ˆå®ç°:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)dispatchSemaphoreDemo &#123;</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    NSMutableArray *array = [NSMutableArray array];</div><div class="line">    for (int i = 0; i &lt; 100000; i++) &#123;</div><div class="line">        dispatch_async(queue, ^&#123;</div><div class="line">            NSLog(@&quot;%@&quot;, [NSThread currentThread]);</div><div class="line">            [array addObject:@(i)];</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å› ä¸ºæ˜¯å¹¶è¡Œé˜Ÿåˆ—, å¼‚æ­¥ä»»åŠ¡, æ‰€ä»¥ä¼šå¼€å¤§é‡çš„çº¿ç¨‹, å¹¶ä¸”è¿™äº›çº¿ç¨‹ä¼šä¿å­˜åœ¨å†…å­˜ä¸­,ç›¸å½“è€—è´¹èµ„æº, æœ€ç»ˆè¿è¡Œçš„ç»“æœå°±æ˜¯å´©æºƒ. é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦é€šè¿‡ä¿¡å·é‡æ¥æ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œ. <code>dispatch_semaphore_t</code>ç±»ä¼¼äºå•ä¸ªé˜Ÿåˆ—çš„æœ€å¤§å¹¶å‘æ•°æ§åˆ¶æœºåˆ¶, æé«˜å¹¶è¡Œæ•ˆç‡çš„åŒæ—¶, ä¹Ÿå¯ä»¥é˜²æ­¢å¤ªå¤šçº¿ç¨‹çš„å¼€è¾Ÿå¯¹ç³»ç»Ÿé€ æˆå¤ªå¤§çš„è´Ÿæ‹…. æ”¹é€ ååº”è¯¥æ˜¯è¿™æ ·çš„: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)dispatchSemaphoreDemo &#123;</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    NSMutableArray *array = [NSMutableArray array];</div><div class="line">    </div><div class="line">    //è®¾ç½®ä¿¡å·é‡åˆå§‹å€¼, å½“ä¿¡å·é‡ä¸º0æ—¶, æ‰€æœ‰ä»»åŠ¡ç­‰å¾…, ä¿¡å·é‡è¶Šå¤§, å…è®¸å¯å¹¶è¡Œæ‰§è¡Œçš„ä»»åŠ¡æ•°é‡è¶Šå¤š. å¹¶å‘çš„çº¿ç¨‹ç”±ç³»ç»Ÿè°ƒé…, ä¸ä¸€å®šä¸€ç›´æ˜¯åŒæ ·çš„ä¸¤æ¡, ä½†æ˜¯æœ€å¤šåªèƒ½åŒæ—¶å­˜åœ¨ä¸¤æ¡.</div><div class="line">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(2);</div><div class="line">    for (int i = 0; i &lt; 100; i++) &#123;</div><div class="line">        </div><div class="line">        //å½“ä¿¡å·é‡å¤§äºç­‰äºè®¾å®šçš„åˆå§‹å€¼æ—¶å°±ç»§ç»­æ‰§è¡Œ, å¦åˆ™ä¸€ç›´ç­‰å¾…</div><div class="line">        dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</div><div class="line">        dispatch_async(queue, ^&#123;</div><div class="line">            //æ‰§è¡Œåˆ°è¿™é‡Œå°±ä»£è¡¨ä¿¡å·é‡å¤§äºç­‰äºè®¾å®šçš„åˆå§‹å€¼, æ‰€ä»¥åœ¨è¿™é‡Œä¿¡å·é‡è¦å‡1</div><div class="line">            NSLog(@&quot;%d+++++%@&quot;, i, [NSThread currentThread]);</div><div class="line">            [array addObject:@(i)];</div><div class="line">            //åˆ°è¿™é‡Œçš„æ—¶å€™, å› ä¸ºå¼‚æ­¥ä»»åŠ¡å·²ç»å°†è¦ç»“æŸ, è¦å°†ä¿¡å·é‡åŠ 1. å¦‚æœå‰é¢æœ‰ç­‰å¾…çš„çº¿ç¨‹, æœ€å…ˆç­‰å¾…çš„çº¿ç¨‹å…ˆæ‰§è¡Œ</div><div class="line">            dispatch_semaphore_signal(semaphore);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GCDå®šæ—¶å™¨"><a href="#GCDå®šæ—¶å™¨" class="headerlink" title="GCDå®šæ—¶å™¨"></a>GCDå®šæ—¶å™¨</h3><p>GCDå®ç°å®šæ—¶å™¨ä¸»è¦ç”¨åˆ°<code>dispatch_source_t</code>å‡½æ•°, è¯¥å‡½æ•°å®é™…æœ‰å¤šç§Type, <code>DISPATCH_SOURCE_TYPE_TIMER</code>æ˜¯å®šæ—¶å™¨ç›¸å…³çš„ä»»åŠ¡, è¿˜æœ‰å…¶ä»–ç±»å‹çš„å¤„ç†äº‹ä»¶ç±»å‹. </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)timerDemo &#123;</div><div class="line">    NSLog(@&quot;%@&quot;, [NSThread currentThread]);</div><div class="line">    //æŒ‡å®šDISPATCH_SOURCE_TYPE_TIMERç±»å‹, ä½œæˆDispatch Source</div><div class="line">    </div><div class="line">    //åœ¨å®šæ—¶å™¨ç»è¿‡æŒ‡å®šæ—¶é—´, æŠŠä»»åŠ¡è¿½åŠ åˆ°main queue</div><div class="line">    dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, dispatch_get_main_queue());</div><div class="line">    </div><div class="line">    //å®šæ—¶å™¨çš„ç›¸å…³è®¾ç½®, å°†å®šæ—¶å™¨è®¾ç½®ä¸º5så, ä¸æŒ‡å®šä¸ºé‡å¤, å…è®¸å»¶è¿Ÿ1s</div><div class="line">    dispatch_source_set_timer(timer, dispatch_time(DISPATCH_TIME_NOW, 5ull * NSEC_PER_SEC), DISPATCH_TIME_FOREVER, 1ull * NSEC_PER_SEC);</div><div class="line">    </div><div class="line">    //æŒ‡å®šå®šæ—¶å™¨æŒ‡å®šæ—¶é—´å†…æ‰§è¡Œçš„å¤„ç†</div><div class="line">    dispatch_source_set_event_handler(timer, ^&#123;</div><div class="line">        NSLog(@&quot;wake up&quot;);</div><div class="line">        dispatch_source_cancel(timer);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //å–æ¶ˆå®šæ—¶å™¨æ—¶çš„å¤„ç†</div><div class="line">    dispatch_source_set_cancel_handler(timer, ^&#123;</div><div class="line">        NSLog(@&quot;canceled&quot;);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //å®šæ—¶å™¨å¯åŠ¨</div><div class="line">    dispatch_resume(timer);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="NSOperationçš„ä¼˜å…ˆçº§"><a href="#NSOperationçš„ä¼˜å…ˆçº§" class="headerlink" title="NSOperationçš„ä¼˜å…ˆçº§"></a>NSOperationçš„ä¼˜å…ˆçº§</h3><p>NSOperationQueueä¸­NSOperationå¯¹è±¡çš„æ‰§è¡Œæ–¹å¼æ˜¯æŒ‰ç…§FIFOçš„åŸåˆ™é¡ºåºæ‰§è¡Œ, ä½†æ˜¯å¦‚æœæˆ‘ä»¬è®¾ç½®äº†ä»»åŠ¡çš„ä¼˜å…ˆçº§, é‚£ä¹ˆç³»ç»Ÿå°±ä¼šç»™ä¼˜å…ˆçº§é«˜çš„ä¼˜å…ˆåˆ†é…èµ„æº. </p>
<p>ä¼˜å…ˆçº§ä¸€å…±æœ‰è¿™å‡ ç§, ä»é«˜åˆ°ä½ä¾æ¬¡æ’åˆ—.<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger, NSOperationQueuePriority) &#123;</div><div class="line">	NSOperationQueuePriorityVeryLow = -8L,</div><div class="line">	NSOperationQueuePriorityLow = -4L,</div><div class="line">	NSOperationQueuePriorityNormal = 0,</div><div class="line">	NSOperationQueuePriorityHigh = 4,</div><div class="line">	NSOperationQueuePriorityVeryHigh = 8</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹, ä¸‰ä¸ªä»»åŠ¡è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å», è¿™ä¸‰ä¸ªä»»åŠ¡åˆ†åˆ«åœ¨ä¸‰ä¸ªçº¿ç¨‹, äº’ä¸å¹²æ‰°, ç±»ä¼¼äºGCDçš„å¼‚æ­¥å¹¶è¡Œæ¨¡å¼, å¦‚æœæˆ‘ä»¬è®¾ç½®<code>invocationOper.queuePriority = NSOperationQueuePriorityVeryLow</code>ç†è®ºä¸Š, <code>invocationOper</code>ä»»åŠ¡ä¼šåœ¨æœ€åæ‰§è¡Œ, ä½†æ˜¯æˆ‘ä»¬å‘ç°å¹¶æ²¡æœ‰, é‚£æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰è®¾ç½®æœ€å¤§å¹¶å‘æ•°çš„åŸå› , æˆ‘çŒœæµ‹ç³»ç»Ÿå¯èƒ½æ˜¯åšäº†æŸäº›é™åˆ¶, è™½ç„¶æ˜¯æ–°å¼€äº†çº¿ç¨‹, ä½†æ˜¯ç”±äºæœ€å¤§å¹¶å‘æ•°å°äºç­‰äº1å®é™…è¿˜æ˜¯æŒ‰ç…§FIFOé¡ºåºæ‰§è¡Œ, <strong>æ‰€ä»¥æ³¨æ„ä¸€å®šè¦è®¾ç½®æœ€å¤§å¹¶å‘æ•°</strong>.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//æŠŠæ³¨é‡Šæ‰“å¼€å°±å¯ä»¥çœ‹åˆ°æƒ³è¦çš„æ•ˆæœ</div><div class="line">- (void)NSOperationQueueRun &#123;</div><div class="line">    NSOperationQueue *queue = [[NSOperationQueue alloc] init];</div><div class="line">    //queue.maxConcurrentOperationCount = 3;</div><div class="line">    NSInvocationOperation *invocationOper = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(invocationOperSel) object:nil];</div><div class="line">    //invocationOper.queuePriority = NSOperationQueuePriorityVeryLow;</div><div class="line">    [queue addOperation:invocationOper];</div><div class="line">    NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^&#123;</div><div class="line">        NSLog(@&quot;NSBlockOperationRun_%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;];</div><div class="line">    [queue addOperation:blockOper];</div><div class="line">    [queue addOperationWithBlock:^&#123;</div><div class="line">        NSLog(@&quot;QUEUEBlockOperationRun_%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)invocationOperSel &#123;</div><div class="line">    NSLog(@&quot;NSInvocationOperationRun_%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="NSOperationçš„ä¾èµ–å…³ç³»"><a href="#NSOperationçš„ä¾èµ–å…³ç³»" class="headerlink" title="NSOperationçš„ä¾èµ–å…³ç³»"></a>NSOperationçš„ä¾èµ–å…³ç³»</h3><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—, åˆ†åˆ«åˆ›å»ºè¦æ‰§è¡Œçš„ä»»åŠ¡, <strong>åœ¨æŠŠè¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å»ä¹‹å‰, é€šè¿‡<code>addDependency</code>æ¥å»ºç«‹ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»</strong>. å¦‚æœæˆ‘ä»¬æ²¡æœ‰è®¾ç½®ä¾èµ–çš„è¯, å¦‚æœè®¾ç½®çš„å¹¶å‘æ•°å¤§äº1,  é‚£ä¹ˆ<code>blockOper_1</code>å’Œ<code>`blockOper_2</code>çš„æ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„. å¯æ˜¯å½“æˆ‘ä»¬æ‰§è¡Œ<code>[blockOper_1 addDependency:blockOper_2]</code>æ—¶, å°±ç»™ä¸¤ä¸ªä»»åŠ¡æ·»åŠ äº†ä¾èµ–å…³ç³», <code>blockOper_1</code>æ°¸è¿œåªä¼šåœ¨<code>blockOper_2</code>åæ‰§è¡Œ. å³ä½¿æˆ‘ä»¬ç»™<code>blockOper_1</code>è®¾ç½®äº†æœ€é«˜çš„ä¼˜å…ˆçº§, å› ä¸º<strong>ä¾èµ–çš„ä¼˜å…ˆçº§è¦é«˜äº<code>queuePriority</code></strong>. </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)NSOperationQueueRun2 &#123;</div><div class="line">    NSOperationQueue *queue = [[NSOperationQueue alloc] init];</div><div class="line">//    queue.maxConcurrentOperationCount = 2;</div><div class="line">    NSBlockOperation *blockOper_1 = [NSBlockOperation blockOperationWithBlock:^&#123;</div><div class="line">        NSLog(@&quot;blockOper_1_%@_%@&quot;,@(1),[NSThread currentThread]);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    NSBlockOperation *blockOper_2 = [NSBlockOperation blockOperationWithBlock:^&#123;</div><div class="line">        NSLog(@&quot;blockOper_2_%@_%@&quot;,@(2),[NSThread currentThread]);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">//    blockOper_1.queuePriority = NSOperationQueuePriorityVeryHigh;</div><div class="line">    [blockOper_1 addDependency:blockOper_2];</div><div class="line">    [queue addOperation:blockOper_1];</div><div class="line">    [queue addOperation:blockOper_2];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ"><a href="#å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ" class="headerlink" title="å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ"></a>å¸¸è§ä½¿ç”¨æ¡ˆåˆ—åˆ†æ</h2><h3 id="æ¡ˆä¾‹ä¸€"><a href="#æ¡ˆä¾‹ä¸€" class="headerlink" title="æ¡ˆä¾‹ä¸€"></a>æ¡ˆä¾‹ä¸€</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)case1 &#123;</div><div class="line">    NSLog(@&quot;ä»»åŠ¡ä¸€ - %@&quot;, [NSThread currentThread]);</div><div class="line">    dispatch_sync(dispatch_get_main_queue(), ^&#123;</div><div class="line">        NSLog(@&quot;åŒæ­¥ä»»åŠ¡ - %@&quot;,[NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    NSLog(@&quot;ä»»åŠ¡äºŒ - %@&quot;, [NSThread currentThread]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»¥ä¸Š<code>- (void)case1</code>é»˜è®¤åœ¨å½“å‰çº¿ç¨‹(ä¸»çº¿ç¨‹)æ‰§è¡Œ,  é¦–å…ˆæ‰§è¡Œâ€ä»»åŠ¡ä¸€â€. ç„¶å<code>dispatch_sync</code>é˜»å¡å½“å‰çº¿ç¨‹(ä¸»çº¿ç¨‹), ç”±äºä¸»é˜Ÿåˆ—æ˜¯ä¸²è¡Œé˜Ÿåˆ—, ä»»åŠ¡ä¸èƒ½å¹¶å‘æ‰§è¡Œ, åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œ. åˆå› ä¸º<strong>â€œåŒæ­¥ä»»åŠ¡â€åå…¥åˆ—, æŒ‰ç…§FIFOåŸåˆ™, å¿…é¡»ç­‰åˆ°<code>- (void)case1</code>æ‰§è¡Œå®Œæ¯•æ‰èƒ½æ‰§è¡Œ</strong>, ä½†æ˜¯<code>- (void)case1</code>ä¸­çš„â€ä»»åŠ¡äºŒâ€åˆåœ¨ç­‰ç€â€åŒæ­¥ä»»åŠ¡â€æ‰§è¡Œå®Œæ¯•æ‰èƒ½æ‰§è¡Œ, è¿™æ ·å°±é€ æˆåŒä¸€é˜Ÿåˆ—ä¸­çš„ä¸¤ä¸ªä»»åŠ¡ç›¸äº’ç­‰å¾…, é€ æˆæ­»é”. </p>
<p><img src="http://img.souche.com/f2e/5b1729532683ad164c061958d5248a66.png" alt="æ¡ˆä¾‹1"></p>
<p>æœ‰ä¸¤ç§è§£å†³æ€è·¯, ä¸€æ˜¯ä¸ºå½“å‰é˜Ÿåˆ—æ‰©å®¹, è®©å®ƒå˜æˆå¹¶è¡Œé˜Ÿåˆ—, å°±ä¸ä¼šé€ æˆé˜»å¡. ç¬¬äºŒç§è§£å†³æ€è·¯æ˜¯æŠŠåŒæ­¥ä»»åŠ¡æ·»åŠ åˆ°ä¸€ä¸ªæ–°çš„è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—ä¸­å», ä¸¤ä¸ªé˜Ÿåˆ—ä¹‹é—´ä¸å­˜åœ¨é˜»å¡å°±é¿å…äº†æ­»é”é—®é¢˜. </p>
<h3 id="æ¡ˆä¾‹äºŒ"><a href="#æ¡ˆä¾‹äºŒ" class="headerlink" title="æ¡ˆä¾‹äºŒ"></a>æ¡ˆä¾‹äºŒ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)case2 &#123;</div><div class="line">    NSLog(@&quot;1&quot;);</div><div class="line">    //3ä¼šç­‰2ï¼Œå› ä¸º2åœ¨å…¨å±€å¹¶è¡Œé˜Ÿåˆ—é‡Œï¼Œä¸éœ€è¦ç­‰å¾…3ï¼Œè¿™æ ·2æ‰§è¡Œå®Œå›åˆ°ä¸»é˜Ÿåˆ—ï¼Œ3å°±å¼€å§‹æ‰§è¡Œ</div><div class="line">    dispatch_sync(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^&#123;</div><div class="line">        NSLog(@&quot;2&quot;);</div><div class="line">    &#125;);</div><div class="line">    NSLog(@&quot;3&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰“å°é¡ºåºä¸€å®šä¸º1, 2, 3. 2æ–°å¼€é˜Ÿåˆ—, ä¸ä¼šé€ æˆæ­»é”. <code>case2</code>å’Œæ–°å¼€çš„blockä»»åŠ¡ä¹‹é—´æ²¡æœ‰é˜Ÿåˆ—çš„çº¦æŸ, ä½†æ˜¯ç”±äºæ˜¯åŒæ­¥ä»»åŠ¡,é˜»å¡çº¿ç¨‹, æ‰€ä»¥blockå…ˆæ‰§è¡Œ, æ‰§è¡Œå®Œæ¯•åå†å›åˆ°<code>case2</code>, æ¥ç€æ‰§è¡Œ.</p>
<p><img src="http://img.souche.com/f2e/27086c860f921209238d3f60c2f8722c.png" alt="æ¡ˆä¾‹2"></p>
<h3 id="æ¡ˆä¾‹ä¸‰"><a href="#æ¡ˆä¾‹ä¸‰" class="headerlink" title="æ¡ˆä¾‹ä¸‰"></a>æ¡ˆä¾‹ä¸‰</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)case3 &#123;</div><div class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;com.demo.serialQueue&quot;, DISPATCH_QUEUE_SERIAL);</div><div class="line">    NSLog(@&quot;1&quot;); // ä»»åŠ¡1</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;2&quot;); // ä»»åŠ¡2</div><div class="line">        dispatch_sync(queue, ^&#123;</div><div class="line">            NSLog(@&quot;3&quot;); // ä»»åŠ¡3</div><div class="line">        &#125;);</div><div class="line">        NSLog(@&quot;4&quot;); // ä»»åŠ¡4</div><div class="line">    &#125;);</div><div class="line">    NSLog(@&quot;5&quot;); // ä»»åŠ¡5</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ§åˆ¶å°è¾“å‡º1, 5, 2. (5, 2çš„é¡ºåºä¸ä¸€å®š). å¯ä»¥è‚¯å®š, ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—. é¦–å…ˆæ‰§è¡Œä»»åŠ¡1, æ¥ä¸‹æ¥æœ‰ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡, æ–°å¼€è¾Ÿçº¿ç¨‹(å°†ä»»åŠ¡2, åŒæ­¥çº¿ç¨‹, ä»»åŠ¡4åŠ å…¥æ–°çº¿ç¨‹). å› ä¸ºæ˜¯å¼‚æ­¥çº¿ç¨‹, ä¸»çº¿ç¨‹ä¸­çš„ä»»åŠ¡5ä¸ç”¨ç­‰å¾…, æ‰€ä»¥ 2 å’Œ 5 çš„è¾“å‡ºé¡ºåºä¸å®š. ä»»åŠ¡2æ‰§è¡Œå®Œå, é‡åˆ°åŒæ­¥ä»»åŠ¡, å› ä¸ºæ˜¯åœ¨ä¸²è¡Œé˜Ÿåˆ—, æ‰€ä»¥ä¼šé˜»å¡å½“å‰çº¿ç¨‹, ä»»åŠ¡3æ‰§è¡Œå®Œåæ‰èƒ½æ‰§è¡Œä»»åŠ¡4. ä½†æ˜¯ä»»åŠ¡4æ¯”ä»»åŠ¡3æ—©åŠ å…¥é˜Ÿåˆ—, æ ¹æ®FIFOåŸåˆ™, ä»»åŠ¡3è¦ç­‰å¾…ä»»åŠ¡4æ‰§è¡Œå®Œåæ‰èƒ½æ‰§è¡Œ. ä»»åŠ¡3å’Œä»»åŠ¡4ç›¸äº’ç­‰å¾…é€ æˆæ­»é”. </p>
<p><img src="http://img.souche.com/f2e/9c13eaeac28f7fe7105af2feb878d5ef.png" alt="æ¡ˆä¾‹ä¸‰å›¾ç‰‡"></p>
<h3 id="æ¡ˆä¾‹å››"><a href="#æ¡ˆä¾‹å››" class="headerlink" title="æ¡ˆä¾‹å››"></a>æ¡ˆä¾‹å››</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)case4 &#123;</div><div class="line">    NSLog(@&quot;1&quot;); // ä»»åŠ¡1</div><div class="line">    dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</div><div class="line">        NSLog(@&quot;2&quot;); // ä»»åŠ¡2</div><div class="line">        dispatch_sync(dispatch_get_main_queue(), ^&#123;</div><div class="line">            NSLog(@&quot;3&quot;); // ä»»åŠ¡3</div><div class="line">        &#125;);</div><div class="line">        NSLog(@&quot;4&quot;); // ä»»åŠ¡4</div><div class="line">    &#125;);</div><div class="line">    NSLog(@&quot;5&quot;); // ä»»åŠ¡5</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœæ˜¯: 1, 5, 2, 3, 4.(2, 5çš„é¡ºåºä¸å®š). é¦–å…ˆåœ¨ä¸»çº¿ç¨‹ä¸­æœ‰ä¸‰ä¸ªä»»åŠ¡, åˆ†åˆ«æ˜¯ä»»åŠ¡1, å¹¶è¡Œé˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡, ä»»åŠ¡5. å¹¶è¡Œé˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡ä¸­åˆæœ‰ä¸‰ä¸ªä»»åŠ¡, åˆ†åˆ«æ˜¯ä»»åŠ¡2, å¼‚æ­¥ä»»åŠ¡, ä»»åŠ¡4.  </p>
<p>æ‰€ä»¥å…ˆæ‰“å°1, ç„¶åæŠŠå¼‚æ­¥ä»»åŠ¡åŠ å…¥å…¨éƒ¨å¹¶è¡Œé˜Ÿåˆ—, ç”±äºæ˜¯å¼‚æ­¥ä»»åŠ¡æ–°å¼€è¾Ÿçº¿ç¨‹, ä¸é˜»å¡ä¸»çº¿ç¨‹, 5ä¸ç”¨ç­‰å¾…. æ‰€ä»¥2, 5é¡ºåºä¸å®š. ç„¶åå†åˆ†æå¹¶è¡Œé˜Ÿåˆ—ä¸­çš„å¼‚æ­¥ä»»åŠ¡, ä»»åŠ¡2æ‰§è¡Œåé‡åˆ°åŒæ­¥ä»»åŠ¡, åŒæ­¥ä»»åŠ¡è¢«åŠ å…¥åˆ°ä¸»çº¿ç¨‹(å› ä¸ºå‰é¢å·²ç»è¢«åŠ è¿‡3ä¸ªä»»åŠ¡, æ‰€ä»¥è¯¥ä»»åŠ¡åœ¨ä»»åŠ¡5åé¢). å› ä¸ºæ˜¯åŒæ­¥, é˜»å¡ä¸»çº¿ç¨‹, æ‰€ä»¥4ä¸€å®šåœ¨3åé¢. </p>
<p><img src="http://img.souche.com/f2e/43a48f9de1c0bb336215543157ad875b.png" alt="æ¡ˆä¾‹å››"></p>
<h3 id="æ¡ˆä¾‹äº”"><a href="#æ¡ˆä¾‹äº”" class="headerlink" title="æ¡ˆä¾‹äº”"></a>æ¡ˆä¾‹äº”</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)case5 &#123;</div><div class="line">    dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</div><div class="line">        NSLog(@&quot;1&quot;); // ä»»åŠ¡1</div><div class="line">        dispatch_sync(dispatch_get_main_queue(), ^&#123;</div><div class="line">            NSLog(@&quot;2&quot;); // ä»»åŠ¡2</div><div class="line">        &#125;);</div><div class="line">        NSLog(@&quot;3&quot;); // ä»»åŠ¡3</div><div class="line">    &#125;);</div><div class="line">    NSLog(@&quot;4&quot;); // ä»»åŠ¡4</div><div class="line">    while (1) &#123;</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;5&quot;); // ä»»åŠ¡5</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœæ˜¯: 1, 4(é¡ºåºä¸å®š). é¦–å…ˆä¸»çº¿ç¨‹ä¸­æœ‰å››ä¸ªä»»åŠ¡, åˆ†åˆ«æ˜¯å…¨å±€å¹¶è¡Œé˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡, ä»»åŠ¡4, æ­»å¾ªç¯, ä»»åŠ¡5. å…¨å±€å¹¶è¡Œé˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡ä¸­åˆæœ‰ä¸‰ä¸ªä»»åŠ¡, åˆ†åˆ«æ˜¯ä»»åŠ¡1, ä¸»çº¿ç¨‹çš„åŒæ­¥ä»»åŠ¡(ä»»åŠ¡2), ä»»åŠ¡3. </p>
<p>ç”±äºæ˜¯å¼‚æ­¥ä»»åŠ¡, ä¸é˜»å¡ä¸»çº¿ç¨‹, æ‰€ä»¥å…¨å±€å¹¶è¡Œé˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œé¡ºåºå’Œä»»åŠ¡4ä¸å®š, å…¨å±€å¹¶è¡Œé˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡åˆæ˜¯å…ˆæ‰§è¡Œä»»åŠ¡1, æ‰€ä»¥ä»»åŠ¡1å’Œä»»åŠ¡4çš„é¡ºåºä¸å®š. å½“ä»»åŠ¡4æ‰§è¡Œå®Œå, è¿›å…¥æ­»å¾ªç¯, ä¸»çº¿ç¨‹è¢«é˜»å¡. ç”±äºåŒæ­¥ä»»åŠ¡(ä»»åŠ¡2)æ˜¯è¢«åŠ åœ¨ä¸»çº¿ç¨‹ä¸­, ä½†æ˜¯æ­¤æ—¶ä¸»çº¿ç¨‹å·²è¢«é˜»å¡, æ‰€ä»¥2ä¸ä¼šè¢«æ‰§è¡Œ. ä»»åŠ¡3åˆæ˜¯åœ¨ä»»åŠ¡2åè¢«åŠ å…¥é˜Ÿåˆ—, ä»»åŠ¡2æ˜¯åŒæ­¥ä»»åŠ¡, æ‰€ä»¥ä»»åŠ¡3è¦ç­‰å¾…ä»»åŠ¡2å®Œæˆæ‰æ‰§è¡Œ. æ‰€ä»¥ä»»åŠ¡2, ä»»åŠ¡3éƒ½ä¸ä¼šæ‰§è¡Œ. ä»»åŠ¡5åœ¨æ­»å¾ªç¯åæ‰§è¡Œ, æ‰€ä»¥ä»»åŠ¡5æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œ. å¦‚æœæ²¡æœ‰æ­»å¾ªç¯, ä»»åŠ¡2è‚¯å®šåœ¨ä»»åŠ¡ååé¢, ä»»åŠ¡3è‚¯å®šåœ¨ä»»åŠ¡2åé¢. </p>
<p><img src="http://img.souche.com/f2e/0d108cba7a737b62e2f5e1be402bc5d0.png" alt="æ¡ˆä¾‹äº”"></p>
<hr>
<p>å‚è€ƒèµ„æ–™:</p>
<p>1.<a href="http://www.cocoachina.com/ios/20150731/12819.html" target="_blank" rel="noopener">å…³äºiOSå¤šçº¿ç¨‹, ä½ çœ‹æˆ‘å°±å¤Ÿäº†</a></p>
<p>2.<a href="https://bestswifter.com/multithreadconclusion/" target="_blank" rel="noopener">iOSå¤šçº¿ç¨‹ç¼–ç¨‹æ€»ç»“</a></p>
<p>3.<a href="http://www.jianshu.com/p/51fd1362249e" target="_blank" rel="noopener">å…³äºiOSå¤šçº¿ç¨‹, æˆ‘è¯´, ä½ å¬, æ²¡å‡†ä½ å°±æ‡‚äº†</a></p>
<p>4.<a href="http://www.jianshu.com/p/06a18323d9d2" target="_blank" rel="noopener">æ·±å…¥ç†è§£ GCD</a></p>
<p>5.<a href="http://www.jianshu.com/p/6a6722f12fe3" target="_blank" rel="noopener">å…³äº iOS å¤šçº¿ç¨‹, éƒ½åœ¨è¿™é‡Œäº†</a></p>
<p>6.<a href="http://blog.csdn.net/mxsgoden/article/details/8821936" target="_blank" rel="noopener">è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«</a></p>
<p>7.<a href="https://laike9m.com/blog/huan-zai-yi-huo-bing-fa-he-bing-xing,61/" target="_blank" rel="noopener">å¹¶å‘å’Œå¹¶è¡Œ</a></p>

    
  </div>
  
    

<!-- Gitalkè¯„è®ºæ’ä»¶é€šç”¨ä»£ç  -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
const gitalk = new Gitalk({
  clientID: '46ee1ac76ef8ec89628d',
  clientSecret: '504604af3c2054d744fef5c3932174d1c29a4d5b',
  repo: 'HChong3210.github.io',
  owner: 'HChong3210',
  // åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸‹æˆªå–å‰50ä¸ªå­—ç¬¦ä¸², è¿™æ˜¯å› ä¸º github å¯¹ label çš„é•¿åº¦æœ‰äº†è¦æ±‚, å¦‚æœè¶…è¿‡
  // 50ä¸ªå­—ç¬¦ä¸²åˆ™ä¼šæŠ¥é”™.
  // id: location.pathname.split('/').pop().substring(0, 49),
  id: location.pathname.split('/').pop().substring(0, 49),
  admin: 'HChong3210',
  // facebook-like distraction free mode
  distractionFreeMode: false
})
gitalk.render('gitalk-container')
</script>
<!-- Gitalkä»£ç ç»“æŸ -->



  
</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2017/08/22/JavaScriptç¬¬äºŒå¼¹/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2017/12/01/RNå®è·µæŒ‡å—/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>





  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">å…³é—­</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              åšå®¢
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              åˆ†ç±»
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              æ ‡ç­¾
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              å…³äº
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              æœç´¢
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

    

<!-- Gitalkè¯„è®ºæ’ä»¶é€šç”¨ä»£ç  -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
const gitalk = new Gitalk({
  clientID: '46ee1ac76ef8ec89628d',
  clientSecret: '504604af3c2054d744fef5c3932174d1c29a4d5b',
  repo: 'HChong3210.github.io',
  owner: 'HChong3210',
  // åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸‹æˆªå–å‰50ä¸ªå­—ç¬¦ä¸², è¿™æ˜¯å› ä¸º github å¯¹ label çš„é•¿åº¦æœ‰äº†è¦æ±‚, å¦‚æœè¶…è¿‡
  // 50ä¸ªå­—ç¬¦ä¸²åˆ™ä¼šæŠ¥é”™.
  // id: location.pathname.split('/').pop().substring(0, 49),
  id: location.pathname.split('/').pop().substring(0, 49),
  admin: 'HChong3210',
  // facebook-like distraction free mode
  distractionFreeMode: false
})
gitalk.render('gitalk-container')
</script>
<!-- Gitalkä»£ç ç»“æŸ -->



  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
